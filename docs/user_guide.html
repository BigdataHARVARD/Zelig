
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>User Guide &mdash; Zelig 5.0 documentation</title>
    
    <link rel="stylesheet" href="../static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../static/my-styles.css" type="text/css" />
    <link rel="stylesheet" href="../static/bootstrap-3.1.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../static/bootstrap-3.1.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="../static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="../static/zelig-small.ico"/>
    <link rel="top" title="Zelig 5.0 documentation" href="../index.html" />
    <link rel="next" title="Developer Guide" href="dev_guide.html" />
    <link rel="prev" title="Quickstart Guide" href="quickstart.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<a href="https://github.com/IQSS/Zelig5"><img style="position: absolute; top: 45px; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>
<div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">

    <div class="container">

      <div class="navbar-header">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>

        <a class="logo"> <img height="32" width="32" src="http://datascience.iq.harvard.edu/files/styles/os_files_small/public/datascience/files/zelig-small_1.png?itok=catC420a" /></a>
        <a class="navbar-brand" href="../index.html">Zelig</a>
        <span class="navbar-text navbar-version pull-left"><b>5.0</b></span>
      </div>
        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://datascience.iq.harvard.edu">Data Science at IQSS</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-r">Installing R</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#installing-zelig">Installing Zelig</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#updating-zelig">Updating Zelig</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#loading-zelig">Loading Zelig</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#running-models">Running Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html#zelig5-model-reference">Zelig5 Model Reference</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-analysis-commands">Data Analysis Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#statistical-commands">Statistical Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graphing-commands">Graphing Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#r-objects">R Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programming-statements">Programming Statements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide.html">Developer Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dev_guide.html#writing-new-models">Writing New Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_guide.html#adding-models-and-methods-to-zelig">Adding Models and Methods to Zelig</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_guide.html#contributing-code">Contributing Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_guide.html#release-notes">Release Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#for-all-zelig-users">For All Zelig Users</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#for-zelig-contributors">For Zelig Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">Zelig History and Name</a><ul>
<li class="toctree-l2"><a class="reference internal" href="about.html#technical-vision">Technical Vision</a></li>
<li class="toctree-l2"><a class="reference internal" href="about.html#release-notes">Release Notes</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">User Guide</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#what-r-and-zelig-do">What R and Zelig do</a></li>
<li><a class="reference internal" href="#getting-help">Getting Help</a></li>
<li><a class="reference internal" href="#how-to-cite-zelig">How to Cite Zelig</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-analysis-commands">Data Analysis Commands</a><ul>
<li><a class="reference internal" href="#command-syntax">Command Syntax</a><ul>
<li><a class="reference internal" href="#data-structures">Data Structures</a></li>
<li><a class="reference internal" href="#loading-data">Loading Data</a><ul>
<li><a class="reference internal" href="#standard-ways-to-load-data">Standard Ways to Load Data</a></li>
<li><a class="reference internal" href="#special-cases-when-loading-data">Special Cases When Loading Data</a></li>
<li><a class="reference internal" href="#verifying-you-loaded-the-data-correctly">Verifying You Loaded The Data Correctly</a></li>
</ul>
</li>
<li><a class="reference internal" href="#saving-data">Saving Data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#variables">Variables</a><ul>
<li><a class="reference internal" href="#classes-of-variables">Classes of Variables</a><ul>
<li><a class="reference internal" href="#types-of-variables">Types of Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recoding-variables">Recoding Variables</a><ul>
<li><a class="reference internal" href="#extracting-replacing-and-generating-new-variables">Extracting, Replacing, and Generating New Variables</a></li>
<li><a class="reference internal" href="#logical-operators">Logical Operators</a></li>
<li><a class="reference internal" href="#coding-and-recoding-variables">Coding and Recoding Variables</a></li>
<li><a class="reference internal" href="#missing-data">Missing Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#statistical-commands">Statistical Commands</a><ul>
<li><a class="reference internal" href="#zelig-commands">Zelig Commands</a><ul>
<li><a class="reference internal" href="#quick-overview">Quick Overview</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#details">Details</a><ul>
<li><a class="reference internal" href="#presenting-results">Presenting Results</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#describe-a-models-systematic-and-stochastic-parameters">Describe a model’s systematic and stochastic parameters</a></li>
<li><a class="reference internal" href="#supported-models">Supported Models</a></li>
<li><a class="reference internal" href="#replication-procedures">Replication Procedures</a><ul>
<li><a class="reference internal" href="#saving-replication-materials">Saving Replication Materials</a></li>
<li><a class="reference internal" href="#replicating-analyses">Replicating Analyses</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#graphing-commands">Graphing Commands</a><ul>
<li><a class="reference internal" href="#drawing-plots">Drawing Plots</a></li>
<li><a class="reference internal" href="#adding-points-lines-and-legends-to-existing-plots">Adding Points, Lines, and Legends to Existing Plots</a></li>
<li><a class="reference internal" href="#saving-graphs-to-files">Saving Graphs to Files</a></li>
<li><a class="reference internal" href="#id17">Examples</a><ul>
<li><a class="reference internal" href="#descriptive-plots-box-plots">Descriptive Plots: Box-plots</a></li>
<li><a class="reference internal" href="#density-plots-a-histogram">Density Plots: A Histogram</a></li>
<li><a class="reference internal" href="#advanced-examples">Advanced Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#r-objects">R Objects</a><ul>
<li><a class="reference internal" href="#scalar-values">Scalar Values</a></li>
<li><a class="reference internal" href="#id18">Data Structures</a><ul>
<li><a class="reference internal" href="#arrays">Arrays</a><ul>
<li><a class="reference internal" href="#ways-to-create-arrays">Ways to create arrays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lists">Lists</a></li>
<li><a class="reference internal" href="#data-frames">Data Frames</a></li>
<li><a class="reference internal" href="#identifying-objects-and-data-structures">Identifying Objects and Data Structures</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#programming-statements">Programming Statements</a><ul>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#if-statements">If-Statements</a></li>
<li><a class="reference internal" href="#for-loops">For-Loops</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="quickstart.html" title="Previous Chapter: Quickstart Guide"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm">&laquo; Quickstart Guide</span>
    </a>
  </li>
  <li>
    <a href="dev_guide.html" title="Next Chapter: Developer Guide"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm">Developer Guide &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-analysis-commands">Data Analysis Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#statistical-commands">Statistical Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#graphing-commands">Graphing Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#r-objects">R Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programming-statements">Programming Statements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">Zelig History and Name</a></li>
</ul>

<div id="sourcelink">
  <a href="../sources/docs/user_guide.txt"
     rel="nofollow">Source</a>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="user-guide">
<span id="userguide"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id25">Introduction</a><ul>
<li><a class="reference internal" href="#what-r-and-zelig-do" id="id26">What R and Zelig do</a></li>
<li><a class="reference internal" href="#getting-help" id="id27">Getting Help</a></li>
<li><a class="reference internal" href="#how-to-cite-zelig" id="id28">How to Cite Zelig</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-analysis-commands" id="id29">Data Analysis Commands</a><ul>
<li><a class="reference internal" href="#command-syntax" id="id30">Command Syntax</a></li>
<li><a class="reference internal" href="#variables" id="id31">Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#statistical-commands" id="id32">Statistical Commands</a><ul>
<li><a class="reference internal" href="#zelig-commands" id="id33">Zelig Commands</a></li>
<li><a class="reference internal" href="#describe-a-models-systematic-and-stochastic-parameters" id="id34">Describe a model’s systematic and stochastic parameters</a></li>
<li><a class="reference internal" href="#supported-models" id="id35">Supported Models</a></li>
<li><a class="reference internal" href="#replication-procedures" id="id36">Replication Procedures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#graphing-commands" id="id37">Graphing Commands</a><ul>
<li><a class="reference internal" href="#drawing-plots" id="id38">Drawing Plots</a></li>
<li><a class="reference internal" href="#adding-points-lines-and-legends-to-existing-plots" id="id39">Adding Points, Lines, and Legends to Existing Plots</a></li>
<li><a class="reference internal" href="#saving-graphs-to-files" id="id40">Saving Graphs to Files</a></li>
<li><a class="reference internal" href="#id17" id="id41">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#r-objects" id="id42">R Objects</a><ul>
<li><a class="reference internal" href="#scalar-values" id="id43">Scalar Values</a></li>
<li><a class="reference internal" href="#id18" id="id44">Data Structures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#programming-statements" id="id45">Programming Statements</a><ul>
<li><a class="reference internal" href="#functions" id="id46">Functions</a></li>
<li><a class="reference internal" href="#if-statements" id="id47">If-Statements</a></li>
<li><a class="reference internal" href="#for-loops" id="id48">For-Loops</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<span id="userguide-introduction"></span><h2><a class="toc-backref" href="#id25">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-r-and-zelig-do">
<h3><a class="toc-backref" href="#id26">What R and Zelig do</a><a class="headerlink" href="#what-r-and-zelig-do" title="Permalink to this headline">¶</a></h3>
<p>Zelig <a href="#id49"><span class="problematic" id="id50"><span id="id1"></span>[1]_</span></a> is an easy-to-use program that can estimate and help
interpret the results of an enormous and growing range of statistical
models. It literally <em>is</em> “everyone’s statistical software” because
Zelig’s unified framework incorporates everyone else’s (R) code. We also
hope it will <em>become</em> “everyone’s statistical software” for
applications, and we have designed Zelig so that anyone can use it or
add their models to it.</p>
<p>When you are using Zelig, you are also using , a powerful statistical
software language. You do not need to learn R separately, however, since
this manual introduces you to R through Zelig, which simplifies R and
reduces the amount of programming knowledge you need to get started.
Because so many individuals contribute different packages to R (each
with their own syntax and documentation), estimating a statistical model
can be a frustrating experience. Users need to know which package
contains the model, find the modeling command within the package, and
refer to the manual page for the model-specific arguments. In contrast,
Zelig users can skip these start-up costs and move directly to data
analyses. Using Zelig’s unified command syntax, you gain the convenience
of a packaged program, without losing any of the power of R’s underlying
statistical procedures.</p>
<p>In addition to generalizing R packages and making existing methods
easier to use, Zelig includes infrastructure that can improve all
existing methods and R programs. Even if you know R, using Zelig greatly
simplifies your work. It mimics the popular program for Stata (and thus
the suggestions of ) by translating the raw output of existing
statistical procedures into quantities that are of direct interest to
researchers. Instead of trying to interpret coefficients parameterized
for modeling convenience, Zelig makes it easy to compute quantities of
real interest: probabilities, predicted values, expected values, first
differences, and risk ratios, along with confidence intervals, standard
errors, or full posterior (or sampling) densities for all quantities.
Zelig extends Clarify by seamlessly integrating an option for
bootstrapping into the simulation of quantities of interest. It also
integrates a full suite of nonparametric matching methods as a
preprocessing step to improve the performance of any parametric model
for causal inference (see ). For missing data, Zelig accepts multiply
imputed datasets created by (see ) and other programs, allowing users to
analyze them as if they were a single, fully observed dataset. Zelig
outputs replication data sets so that you (and if you wish, anyone else)
will always be able to replicate the results of your analyses (see ).
Several powerful Zelig commands also make running multiple analyses and
recoding variables simple.</p>
<p>Using R in combination with Zelig has several advantages over commercial
statistical software. R and Zelig are part of the open source movement,
which is roughly based on the principles of science. That is, anyone who
adds functionality to open source software or wishes to redistribute it
(legally) must provide the software accompanied by its source free of
charge. <a href="#id51"><span class="problematic" id="id52"><span id="id2"></span>[2]_</span></a> If you find a bug in open source software and post a note
to the appropriate mailing list, a solution you can use will likely be
posted quickly by one of the thousands of people using the program all
over the world. Since you can see the source code, you might even be
able to fix it yourself. In contrast, if something goes wrong with
commercial software, you have to wait for the programmers at the company
to fix it (and speaking with them is probably out of the question), and
wait for a new version to be released.</p>
<p>We find that Zelig makes students and colleagues more amenable to using
R, since the startup costs are lower, and since the manual and software
are relatively self-contained. This manual even includes an appendix
devoted to the basics of advanced R programming, although you will not
need it to run most procedures in Zelig. A large and growing fraction of
the world’s quantitative methodologists and statisticians are moving to
R, and the base of programs available for R is quickly surpassing all
alternatives. In addition to built-in functions, R is a complete
programming language, which allows you to design new functions to suit
your needs. R has the dual advantage that you do not need to understand
how to program to use it, but if it turns out that you want to do
something more complicated, you do not need to learn another program. In
addition, methodologists all over the world add new functions all the
time, so if the function you need wasn’t there yesterday, it may be
available today.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Zelig is named after a Woody Allen movie about a man who had the
strange ability to become the physical reflection of anyone he met —
Scottish, African-American, Indian, Chinese, thin, obese, medical
doctor, Hassidic rabbi, anything — and thus to fit well in any
situation.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td>As specified in the <a class="reference external" href="http://www.gnu.org/copyleft">http://www.gnu.org/copyleft</a>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="getting-help">
<h3><a class="toc-backref" href="#id27">Getting Help</a><a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h3>
<p>You may find documentation for Zelig on-line (and hence must be on-line
to access it). If you are unable to connect to the Internet, we
recommend that you print the pdf version of this document for your
reference.</p>
<p>If you are on-line, you may access comprehensive help files for Zelig
commands and for each of the models. For example, load the Zelig library
and then type at the R prompt:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; help.zelig(command)                # For help with all zelig commands.
&gt; help.zelig(logit)                  # For help with the logit model.
</pre></div>
</div>
<p>[Rhelp]In addition, help.zelig() searches the manual pages for R in
addition to the Zelig specific pages. On certain rare occasions, the
name of the help topic in Zelig and in R are identical. In these cases,
help.zelig() will return the Zelig help page by default. If you wish to
access the R help page, you should use help(topic).</p>
<p>In addition, built-in examples with sample data and plots are available
for each model. For example, type demo(logit) to view the demo for the
logit model. Commented code for each model is available under the
examples section of each model reference page.</p>
<p>Please direct inquiries and problems about Zelig to our listserv at . We
suggest you subscribe to this mailing list while learning and using
Zelig: go to . (You can choose to receive email in digest form, so that
you will never receive more than one message per day.) You can also
browse or search our of previous messages before posting your query.</p>
</div>
<div class="section" id="how-to-cite-zelig">
<h3><a class="toc-backref" href="#id28">How to Cite Zelig</a><a class="headerlink" href="#how-to-cite-zelig" title="Permalink to this headline">¶</a></h3>
<p>To cite Zelig as a whole, please reference these two sources:</p>
<blockquote>
<div><p>Kosuke Imai, Gary King, and Olivia Lau. 2007. “Zelig: Everyone’s
Statistical Software,” <a class="reference external" href="http://GKing.harvard.edu/zelig">http://GKing.harvard.edu/zelig</a>.</p>
<p>Imai, Kosuke, Gary King, and Olivia Lau. (2008). “Toward A Common
Framework for Statistical Analysis and Development.” Journal of
Computational and Graphical Statistics, Vol. 17, No. 4 (December),
pp. 892-913.</p>
</div></blockquote>
<p>To refer to a particular Zelig model, please refer to the “how to cite”
portion at the end of each model documentation section.</p>
</div>
</div>
<div class="section" id="data-analysis-commands">
<span id="userguide-data-analysis"></span><h2><a class="toc-backref" href="#id29">Data Analysis Commands</a><a class="headerlink" href="#data-analysis-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-syntax">
<h3><a class="toc-backref" href="#id30">Command Syntax</a><a class="headerlink" href="#command-syntax" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Once R is installed, you only need to know a few basic elements to get
started. It’s important to remember that R, like any spoken language,
has rules for proper syntax. Unlike English, however, the rules for
intelligible R are small in number and quite precise (see ).</p>
<ol class="arabic simple">
<li>To start R under Linux or Unix, type R at the terminal prompt or M-x
R under ESS.</li>
<li>The R prompt is &gt;.</li>
<li>Type commands and hit enter to execute. (No additional characters,
such as semicolons or commas, are necessary at the end of lines.)</li>
<li>To quit from R, type <tt class="docutils literal"><span class="pre">q()</span></tt> and press enter.</li>
<li>The # character makes R ignore the rest of the line, and is used in
this document to comment R code.</li>
<li>We highly recommend that you make a separate working directory or
folder for each project.</li>
<li>Each R session has a workspace, or working memory, to store the
<em>objects</em> that you create or input. These objects may be:<ol class="arabic">
<li><em>values</em>, which include numerical, integer, character, and logical
values;</li>
<li><em>data structures</em> made up of variables (vectors), matrices, and
data frames; or</li>
<li><em>functions</em> that perform the desired tasks on user-specified
values or data structures.</li>
</ol>
</li>
</ol>
<p>After starting R, you may at any time use Zelig’s built-in help function
to access on-line help for any command. To see help for all Zelig
commands, type help.zelig(command), which will take you to the help page
for all Zelig commands. For help with a specific Zelig or R command
substitute the name of the command for the generic command. For example,
type help.zelig(logit) to view help for the logit model.</p>
</div></blockquote>
<p>.</p>
<blockquote>
<div><p>Zelig uses the syntax of R, which has several essential elements:</p>
<ol class="arabic">
<li><p class="first">R is case sensitive. <tt class="docutils literal"><span class="pre">Zelig</span></tt>, the package or library, is not the
same as <tt class="docutils literal"><span class="pre">zelig</span></tt>, the command.</p>
</li>
<li><p class="first">R functions accept user-defined arguments: while some arguments are
required, other optional arguments modify the function’s default
behavior. Enclose arguments in parentheses and separate multiple
arguments with commas. For example, print(x) or print(x, digits = 2)
prints the contents of the object x using the default number of
digits or rounds to two digits to the right of the decimal point,
respectively. You may nest commands as long as each has its own set
of parentheses: <tt class="docutils literal"><span class="pre">log(sqrt(5))</span></tt> takes the square root of 5 and then
takes the natural log.</p>
</li>
<li><p class="first">The &lt;- operator takes the output of the function on the right and
saves them in the named object on the left. For example, z.out &lt;-
zelig(…) stores the output from zelig() as the object z.out in your
working memory. You may use z.out as an argument in other functions,
view the output by typing z.out at the R prompt, or save z.out to a
file using the procedures described in .</p>
</li>
<li><p class="first">You may name your objects anything, within a few constraints:</p>
<ul class="simple">
<li>You may only use letters (in upper or lower case) and periods to
punctuate your variable names.</li>
<li>You may <em>not</em> use any special characters (aside from the period)
or spaces to punctuate your variable names.</li>
<li>Names cannot begin with numbers. For example, R will not let you
save an object as <tt class="docutils literal"><span class="pre">1997.election</span></tt> but will let you save
<tt class="docutils literal"><span class="pre">election.1997</span></tt>.</li>
</ul>
</li>
<li><p class="first">Use the names() command to see the contents of R objects, and the $
operator to extract elements from R objects. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="c1"># Run least squares regression and save the output in working memory:</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>y <span class="o">~</span> x1 <span class="o">+</span> x2<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;ls&quot;</span><span class="p">,</span> data <span class="o">=</span> mydata<span class="p">)</span>
<span class="c1"># See what&#39;s in the R object:</span>
<span class="o">&gt;</span> names<span class="p">(</span>z.out<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;coefficients&quot;</span>  <span class="s">&quot;residuals&quot;</span>  <span class="s">&quot;effects&quot;</span>  <span class="s">&quot;rank&quot;</span>
<span class="c1"># Extract and display the coefficients in z.out:</span>
<span class="o">&gt;</span> z.out<span class="o">$</span>coefficients
</pre></div>
</div>
</li>
<li><p class="first">All objects have a class designation which tells R how to treat it in
subsequent commands. An object’s class is generated by the function
or mathematical operation that created it.</p>
</li>
<li><p class="first">To see a list of all objects in your current workspace, type:
<tt class="docutils literal"><span class="pre">ls()</span></tt>. You can remove an object permanently from memory by typing
<tt class="docutils literal"><span class="pre">remove(goo)</span></tt> (which deletes the object goo), or remove all the
objects with remove(list = ls()).</p>
</li>
<li><p class="first">To run commands in a batch, use a text editor (such as the Windows R
script editor or emacs) to compose your R commands, and save the file
with a .R file extension in your working directory. To run the file,
type <tt class="docutils literal"><span class="pre">source(Code.R)</span></tt> at the R prompt.</p>
</li>
</ol>
<p>If you encounter a syntax error, check your spelling, case, parentheses,
and commas. These are the most common syntax errors, and are easy to
detect and correct with a little practice. If you encounter a syntax
error in batch mode, R will tell you the line on which the syntax error
occurred.</p>
</div></blockquote>
<div class="section" id="data-structures">
<h4>Data Structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">¶</a></h4>
<p>Zelig uses only three of R’s many data structures:</p>
<ol class="arabic simple">
<li>A <strong>variable</strong> is a one-dimensional vector of length .</li>
<li>A <strong>data frame</strong> is a rectangular matrix with  rows and
 columns. Each column represents a variable and each row an
observation. Each variable may have a different class. (See for a
list of classes.) You may refer to specific variables from a data
frame using, for example, data$variable.</li>
<li>A <strong>list</strong> is a combination of different data structures. For
example, z.out contains both coefficients (a vector) and data (a data
frame). Use names() to view the elements available within a list, and
the $ operator to refer to an element in a list.</li>
</ol>
<p>For a more comprehensive introduction, including ways to manipulate
these data structures, please refer to Chapter [a:R].</p>
</div>
<div class="section" id="loading-data">
<h4>Loading Data<a class="headerlink" href="#loading-data" title="Permalink to this headline">¶</a></h4>
<p>Datasets in Zelig are stored in “data frames.” In this section, we
explain the standard ways to load data from disk into memory, how to
handle special cases, and how to verify that the data you loaded is what
you think it is.</p>
<div class="section" id="standard-ways-to-load-data">
<h5>Standard Ways to Load Data<a class="headerlink" href="#standard-ways-to-load-data" title="Permalink to this headline">¶</a></h5>
<p>Make sure that the data file is saved in your working directory. You can
check to see what your working directory is by starting R, and typing
getwd(). If you wish to use a different directory as your starting
directory, use <tt class="docutils literal"><span class="pre">setwd(&quot;dirpath&quot;)</span></tt>, where <tt class="docutils literal"><span class="pre">&quot;dirpath&quot;</span></tt> is the full
directory path of the directory you would like to use as your working
directory.</p>
<p>After setting your working directory, load data using one of the
following methods:</p>
<ol class="arabic">
<li><p class="first">If your dataset is in a <strong>tab- or space-delimited .txt file</strong>, use
<tt class="docutils literal"><span class="pre">read.table(mydata.txt)</span></tt></p>
</li>
<li><p class="first">If your dataset is <strong>a comma separated table</strong>, use
<tt class="docutils literal"><span class="pre">read.csv(mydata.csv)</span></tt>.</p>
</li>
<li><p class="first">To import <strong>SPSS, Stata, and other data files</strong>, use the foreign
package, which automatically preserves field characteristics for each
variable. Thus, variables classed as dates in Stata are automatically
translated into values in the date class for R. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>foreign<span class="p">)</span>                           <span class="c1"># Load the foreign package.</span>
<span class="o">&gt;</span> stata.data <span class="o">&lt;-</span> read.dta<span class="p">(</span><span class="s">&quot;mydata.dta&quot;</span><span class="p">)</span>       <span class="c1"># For Stata data.</span>
<span class="o">&gt;</span> spss.data <span class="o">&lt;-</span> read.spss<span class="p">(</span><span class="s">&quot;mydata.sav&quot;</span><span class="p">,</span> to.data.frame <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># For SPSS.</span>
</pre></div>
</div>
</li>
<li><p class="first">To load data in R format, use load(“mydata.RData”).</p>
</li>
<li><p class="first">For sample data sets included with R packages such as Zelig, you may
use the data() command, which is a shortcut for loading data from the
sample data directories. Because the locations of these directories
vary by installation, it is extremely difficult to locate sample data
sets and use one of the three preceding methods; data() searches all
of the currently used packages and loads sample data automatically.
For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>Zelig<span class="p">)</span>                              <span class="c1"># Loads the Zelig library.</span>
<span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>                               <span class="c1"># Loads the turnout data.</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="special-cases-when-loading-data">
<h5>Special Cases When Loading Data<a class="headerlink" href="#special-cases-when-loading-data" title="Permalink to this headline">¶</a></h5>
<p>These procedures apply to any of the above read commands:</p>
<ol class="arabic">
<li><p class="first">If your file uses the <strong>first row to identify variable names</strong>, you
should use the option <tt class="docutils literal"><span class="pre">header</span> <span class="pre">=</span> <span class="pre">TRUE</span></tt> to import those field names.
For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> read.csv<span class="p">(</span><span class="s">&quot;mydata.csv&quot;</span><span class="p">,</span> header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
<p>will read the words in the first row as the variable names and the
subsequent rows (each with the same number of values as the first) as
observations for each of those variables. If you have additional
characters on the last line of the file or fewer values in one of the
rows, you need to edit the file before attempting to read the data.</p>
</li>
<li><p class="first">The R missing value code is <tt class="docutils literal"><span class="pre">NA</span></tt>. If this value is in your data, R
will recognize your missing values as such. If you have instead used
a place-holder value (such as -9) to represent missing data, you need
to tell R this on loading the data:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> read.table<span class="p">(</span><span class="s">&quot;mydata.tab&quot;</span><span class="p">,</span> header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> na.strings <span class="o">=</span> <span class="s">&quot;-9&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: You must enclose your place holder values in quotes.</p>
</li>
<li><p class="first">Unlike Windows, the file extension in R does not determine the
default method for dealing with the file. For example, if your data
is tab-delimited, but saved as a .sav file,
<tt class="docutils literal"><span class="pre">read.table(mydata.sav)</span></tt> will load your data into R.</p>
</li>
</ol>
</div>
<div class="section" id="verifying-you-loaded-the-data-correctly">
<h5>Verifying You Loaded The Data Correctly<a class="headerlink" href="#verifying-you-loaded-the-data-correctly" title="Permalink to this headline">¶</a></h5>
<p>Whichever method you use, try the <tt class="docutils literal"><span class="pre">names()</span></tt>, <tt class="docutils literal"><span class="pre">dim()</span></tt>, and
<tt class="docutils literal"><span class="pre">summary()</span></tt> commands to verify that the data was properly loaded. For
example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;mydata.csv&quot;</span><span class="p">,</span> header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>             <span class="c1"># Read the data.</span>
<span class="o">&gt;</span> dim<span class="p">(</span>data<span class="p">)</span>                    <span class="c1"># Displays the dimensions of the data frame</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">16000</span>  <span class="m">8</span>                   <span class="c1">#  in rows then columns.</span>
<span class="o">&gt;</span> data<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,]</span>                  <span class="c1"># Display rows 1-10 and all columns.</span>
<span class="o">&gt;</span> names<span class="p">(</span>data<span class="p">)</span>                  <span class="c1"># Check the variable names.</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;V1&quot;</span> <span class="s">&quot;V2&quot;</span> <span class="s">&quot;V3&quot;</span>             <span class="c1"># These values indicate that the variables</span>
                               <span class="c1">#  weren&#39;t named, and took default values.</span>
<span class="o">&gt;</span> names<span class="p">(</span>data<span class="p">)</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;income&quot;</span><span class="p">,</span> <span class="s">&quot;educate&quot;</span><span class="p">,</span> <span class="s">&quot;year&quot;</span><span class="p">)</span>     <span class="c1"># Assign variable names.</span>
<span class="o">&gt;</span> summary<span class="p">(</span>data<span class="p">)</span>                <span class="c1"># Returning a summary for each variable.</span>
</pre></div>
</div>
<p>In this case, the summary() command will return the maximum, minimum,
mean, median, first and third quartiles, as well as the number of
missing values for each variable.</p>
</div>
</div>
<div class="section" id="saving-data">
<h4>Saving Data<a class="headerlink" href="#saving-data" title="Permalink to this headline">¶</a></h4>
<p>Use <tt class="docutils literal"><span class="pre">save()</span></tt> to write data or any object to a file in your working
directory. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> save<span class="p">(</span>mydata<span class="p">,</span> file <span class="o">=</span> <span class="s">&quot;mydata.RData&quot;</span><span class="p">)</span>     <span class="c1"># Saves `mydata&#39; to `mydata.RData&#39;</span>
                                          <span class="c1">#  in your working directory.</span>
<span class="o">&gt;</span> save.image<span class="p">()</span>                            <span class="c1"># Saves your entire workspace to</span>
                                          <span class="c1">#  the default `.RData&#39; file.</span>
</pre></div>
</div>
<p>R will also prompt you to save your workspace when you use the <tt class="docutils literal"><span class="pre">q()</span></tt>
command to quit. When you start R again, it will load the previously
saved workspace. Restarting R will not, however, load previously used
packages. You must remember to load Zelig at the beginning of every R
session.</p>
<p>Alternatively, you can recall individually saved objects from .RData
files using the load() command. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> load<span class="p">(</span><span class="s">&quot;mydata.RData&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>loads the objects saved in the mydata.RData file. You may save a data
frame, a data frame and associated functions, or other R objects to
file.</p>
</div>
</div>
<div class="section" id="variables">
<h3><a class="toc-backref" href="#id31">Variables</a><a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="classes-of-variables">
<h4>Classes of Variables<a class="headerlink" href="#classes-of-variables" title="Permalink to this headline">¶</a></h4>
<p>R variables come in several types. Certain Zelig models require
dependent variables of a certain class of variable. (These are
documented under the manual pages for each model.) Use class(variable)
to determine the class of a variable or class(data$variable) for a
variable within a data frame.</p>
<div class="section" id="types-of-variables">
<h5>Types of Variables<a class="headerlink" href="#types-of-variables" title="Permalink to this headline">¶</a></h5>
<p>For all types of variable (vectors), you may use the c() command to
“concatenate” elements into a vector, the : operator to generate a
sequence of integer values, the seq() command to generate a sequence of
non-integer values, or the rep() function to repeat a value to a
specified length. In addition, you may use the &lt;- operator to save
variables (or any other objects) to the workspace. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> logic <span class="o">&lt;-</span> c<span class="p">(</span><span class="kc">TRUE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># Creates `logic&#39; (5 T/F values).</span>
<span class="o">&gt;</span> var1 <span class="o">&lt;-</span> <span class="m">10</span><span class="o">:</span><span class="m">20</span>                             <span class="c1"># All integers between 10 and 20.</span>
<span class="o">&gt;</span> var2 <span class="o">&lt;-</span> seq<span class="p">(</span>from <span class="o">=</span> <span class="m">5</span><span class="p">,</span> to <span class="o">=</span> <span class="m">10</span><span class="p">,</span> by <span class="o">=</span> <span class="m">0.5</span><span class="p">)</span>  <span class="c1"># Sequence from 5 to 10 by</span>
                                            <span class="c1">#  intervals of 0.5.</span>
<span class="o">&gt;</span> var3 <span class="o">&lt;-</span> rep<span class="p">(</span><span class="kc">NA</span><span class="p">,</span> length <span class="o">=</span> <span class="m">20</span><span class="p">)</span>              <span class="c1"># 20 `NA&#39; values.</span>
<span class="o">&gt;</span> var4 <span class="o">&lt;-</span> c<span class="p">(</span>rep<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">15</span><span class="p">),</span> rep<span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">15</span><span class="p">))</span>         <span class="c1"># 15 `1&#39;s followed by 15 `0&#39;s.</span>
</pre></div>
</div>
<p>For the seq() command, you may alternatively specify length instead of
by to create a variable with a specific number (denoted by the length
argument) of evenly spaced elements.</p>
<ol class="arabic">
<li><p class="first"><strong>Numeric</strong> variables are real numbers and the default variable class
for most dataset values. You can perform any type of math or logical
operation on numeric values. If var1 and var2 are numeric variables,
we can compute</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var3 <span class="o">&lt;-</span> log<span class="p">(</span>var2<span class="p">)</span> <span class="o">-</span> <span class="m">2</span><span class="o">*</span>var1      <span class="c1"># Create `var3&#39; using math operations.</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">Inf</span></tt> (infinity), <tt class="docutils literal"><span class="pre">-Inf</span></tt> (negative infinity), <tt class="docutils literal"><span class="pre">NA</span></tt> (missing
value), and <tt class="docutils literal"><span class="pre">NaN</span></tt> (not a number) are special numeric values on
which most math operations will fail. (Logical operations will work,
however.) Use as.numeric() to transform variables into numeric
variables. Integers are a special class of numeric variable.</p>
</li>
<li><p class="first"><strong>Logical</strong> variables contain values of either <tt class="docutils literal"><span class="pre">TRUE</span></tt> or <tt class="docutils literal"><span class="pre">FALSE</span></tt>.
R supports the following logical operators: ==, exactly equals; &gt;,
greater than; &lt;, less than; &gt;=, greater than or equals; &lt;=, less than
or equals; and !=, not equals. The = symbol is <em>not</em> a logical
operator. Refer to for more detail on logical operators. If var1 and
var2 both have  observations, commands such as</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var3 <span class="o">&lt;-</span> var1 <span class="o">&lt;</span> var2
<span class="o">&gt;</span> var3 <span class="o">&lt;-</span> var1 <span class="o">==</span> var2
</pre></div>
</div>
<p>create  TRUE/FALSE observations such that the th
observation in var3 evaluates whether the logical statement is true
for the th value of var1 with respect to the th
value of var2. Logical variables should usually be converted to
integer values prior to analysis; use the as.integer() command.</p>
</li>
<li><p class="first"><strong>Character</strong> variables are sets of text strings. Note that text
strings are always enclosed in quotes to denote that the string is a
value, not an object in the workspace or an argument for a function
(neither of which take quotes). Variables of class character are not
normally used in data analysis, but used as descriptive fields. If a
character variable is used in a statistical operation, it must first
be transformed into a factored variable.</p>
</li>
<li><p class="first"><strong>Factor</strong> variables may contain values consisting of either integers
or character strings. Use factor() or as.factor() to convert
character or integer variables into factor variables. Factor
variables separate unique values into levels. These levels may either
be ordered or unordered. In practice, this means that including a
factor variable among the explanatory variables is equivalent to
creating dummy variables for each level. In addition, some models
(ordinal logit, ordinal probit, and multinomial logit), require that
the dependent variable be a factor variable.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="recoding-variables">
<h4>Recoding Variables<a class="headerlink" href="#recoding-variables" title="Permalink to this headline">¶</a></h4>
<p>Researchers spend a significant amount of time cleaning and recoding
data prior to beginning their analyses. R has several procedures to
facilitate the process.</p>
<div class="section" id="extracting-replacing-and-generating-new-variables">
<h5>Extracting, Replacing, and Generating New Variables<a class="headerlink" href="#extracting-replacing-and-generating-new-variables" title="Permalink to this headline">¶</a></h5>
<p>While it is not difficult to recode variables, the process is prone to
human error. Thus, we recommend that before altering the data, you save
your existing data frame using the procedures described in&nbsp;, that you
only recode one variable at a time, and that you recode the variable
outside the data frame and then return it to the data frame.</p>
<p>To extract the variable you wish to recode, type:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var <span class="o">&lt;-</span> data<span class="o">$</span>var1               <span class="c1"># Copies `var1&#39; from `data&#39;, creating `var&#39;.</span>
</pre></div>
</div>
<p>Do <em>not</em> sort the extracted variable or delete observations from it. If
you do, the th observation in var will no longer match the
th observation in data.</p>
<p>To replace the variable or generate a new variable in the data frame,
type: [insert]</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="o">$</span>var1 <span class="o">&lt;-</span> var                <span class="c1"># Replace `var1&#39; in `data&#39; with `var&#39;.</span>
<span class="o">&gt;</span> data<span class="o">$</span>new.var <span class="o">&lt;-</span> var             <span class="c1"># Generate `new.var&#39; in `data&#39; using `var&#39;.</span>
</pre></div>
</div>
<p>To remove a variable from a data frame (rather than replacing one
variable with another):</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="o">$</span>var1 <span class="o">&lt;-</span> <span class="kc">NULL</span>
</pre></div>
</div>
</div>
<div class="section" id="logical-operators">
<h5>Logical Operators<a class="headerlink" href="#logical-operators" title="Permalink to this headline">¶</a></h5>
<p>R has an intuitive method for recoding variables, which relies on
logical operators that return statements of TRUE and FALSE. A
mathematical operator (such as ==, !=, &gt;, &gt;= &lt;, and &lt;=) takes two
objects of equal dimensions (scalars, vectors of the same length,
matrices with the same number of rows and columns, or similarly
dimensioned arrays) and compares every element in the first object to
its counterpart in the second object.</p>
<ul>
<li><p class="first">==: checks that one variable “exactly equals” another in a list-wise
manner. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span>                <span class="c1"># Creates the object `x&#39;.</span>
<span class="o">&gt;</span> y <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>                <span class="c1"># Creates the object `y&#39;.</span>
<span class="o">&gt;</span> x <span class="o">==</span> y                               <span class="c1"># Only the 3rd `x&#39; exactly equals</span>
  <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>    <span class="c1">#  its counterpart in `y&#39;.</span>
</pre></div>
</div>
<p>(The = symbol is <em>not</em> a logical operator.)</p>
</li>
<li><p class="first">!=: checks that one variable does not equal the other in a list-wise
manner. Continuing the example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">!=</span> y
  <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>
</pre></div>
</div>
</li>
<li><p class="first">&gt; (&gt;=): checks whether each element in the left-hand object is
greater than (or equal to) every element in the right-hand object.
Continuing the example from above:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&gt;</span> y                                   <span class="c1"># Only the 5th `x&#39; is greater</span>
  <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>       <span class="c1">#  than its counterpart in `y&#39;.</span>
<span class="o">&gt;</span> x <span class="o">&gt;=</span> y                                  <span class="c1"># The 3rd `x&#39; is equal to the</span>
  <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>       <span class="c1">#  3rd `y&#39; and becomes TRUE.</span>
</pre></div>
</div>
</li>
<li><p class="first">&lt; (&lt;=): checks whether each element in the left-hand object is less
than (or equal to) every object in the right-hand object. Continuing
the example from above:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;</span> y                           <span class="c1"># The elements 1, 2, and 4 of `x&#39; are</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="c1">#  less than their counterparts in `y&#39;.</span>
<span class="o">&gt;</span> x <span class="o">&lt;=</span> y                          <span class="c1"># The 3rd `x&#39; is equal to the 3rd `y&#39;</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="c1">#  and becomes TRUE.</span>
</pre></div>
</div>
</li>
</ul>
<p>For two vectors of five elements, the mathematical operators compare the
first element in x to the first element in y, the second to the second
and so forth. Thus, a mathematical comparison of x and y returns a
vector of five TRUE/FALSE statements. Similarly, for two matrices with 3
rows and 20 columns each, the mathematical operators will return a
 matrix of logical values.</p>
<p>There are additional logical operators which allow you to combine and
compare logical statements:</p>
<ul>
<li><p class="first">&amp;: is the logical equivalent of “and”, and evaluates one array of
logical statements against another in a list-wise manner, returning a
TRUE only if both are true in the same location. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> a <span class="o">&lt;-</span> matrix<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">),</span> nrow <span class="o">=</span> <span class="m">3</span><span class="p">,</span> ncol <span class="o">=</span> <span class="m">4</span><span class="p">)</span>      <span class="c1"># Creates a matrix `a&#39;.</span>
<span class="o">&gt;</span> a
     <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span> <span class="p">[,</span><span class="m">4</span><span class="p">]</span>
<span class="p">[</span><span class="m">1</span><span class="p">,]</span>    <span class="m">1</span>    <span class="m">4</span>    <span class="m">7</span>   <span class="m">10</span>
<span class="p">[</span><span class="m">2</span><span class="p">,]</span>    <span class="m">2</span>    <span class="m">5</span>    <span class="m">8</span>   <span class="m">11</span>
<span class="p">[</span><span class="m">3</span><span class="p">,]</span>    <span class="m">3</span>    <span class="m">6</span>    <span class="m">9</span>   <span class="m">12</span>
<span class="o">&gt;</span> b <span class="o">&lt;-</span> matrix<span class="p">(</span>c<span class="p">(</span><span class="m">12</span><span class="o">:</span><span class="m">1</span><span class="p">),</span> nrow <span class="o">=</span> <span class="m">3</span><span class="p">,</span> ncol <span class="o">=</span> <span class="m">4</span><span class="p">)</span>      <span class="c1"># Creates a matrix `b&#39;.</span>
<span class="o">&gt;</span> b
     <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span> <span class="p">[,</span><span class="m">4</span><span class="p">]</span>
<span class="p">[</span><span class="m">1</span><span class="p">,]</span>   <span class="m">12</span>    <span class="m">9</span>    <span class="m">6</span>    <span class="m">3</span>
<span class="p">[</span><span class="m">2</span><span class="p">,]</span>   <span class="m">11</span>    <span class="m">8</span>    <span class="m">5</span>    <span class="m">2</span>
<span class="p">[</span><span class="m">3</span><span class="p">,]</span>   <span class="m">10</span>    <span class="m">7</span>    <span class="m">4</span>    <span class="m">1</span>
<span class="o">&gt;</span> v1 <span class="o">&lt;-</span> a <span class="o">&gt;</span> <span class="m">3</span>                    <span class="c1"># Creates the matrix `v1&#39; (T/F values).</span>
<span class="o">&gt;</span> v2 <span class="o">&lt;-</span> b <span class="o">&gt;</span> <span class="m">3</span>                    <span class="c1"># Creates the matrix `v2&#39; (T/F values).</span>
<span class="o">&gt;</span> v1 <span class="o">&amp;</span> v2                        <span class="c1"># Checks if the (i,j) value in `v1&#39; and</span>
      <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span>  <span class="p">[,</span><span class="m">4</span><span class="p">]</span>       <span class="c1">#  `v2&#39; are both TRUE.  Because columns</span>
<span class="p">[</span><span class="m">1</span><span class="p">,]</span> <span class="kc">FALSE</span> <span class="kc">TRUE</span> <span class="kc">TRUE</span> <span class="kc">FALSE</span>       <span class="c1">#  2-4 of `v1&#39; are TRUE, and columns 1-3</span>
<span class="p">[</span><span class="m">2</span><span class="p">,]</span> <span class="kc">FALSE</span> <span class="kc">TRUE</span> <span class="kc">TRUE</span> <span class="kc">FALSE</span>       <span class="c1">#  of `var2&#39; are TRUE, columns 2-3 are</span>
<span class="p">[</span><span class="m">3</span><span class="p">,]</span> <span class="kc">FALSE</span> <span class="kc">TRUE</span> <span class="kc">TRUE</span> <span class="kc">FALSE</span>       <span class="c1">#  TRUE here.</span>
<span class="o">&gt;</span> <span class="p">(</span>a <span class="o">&gt;</span> <span class="m">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>b <span class="o">&gt;</span> <span class="m">3</span><span class="p">)</span>              <span class="c1"># The same, in one step.</span>
</pre></div>
</div>
<p>For more complex comparisons, parentheses may be necessary to delimit
logical statements.</p>
</li>
<li><p class="first">|: is the logical equivalent of “or”, and evaluates in a list-wise
manner whether either of the values are TRUE. Continuing the example
from above:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> <span class="p">(</span>a <span class="o">&lt;</span> <span class="m">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span>b <span class="o">&lt;</span> <span class="m">3</span><span class="p">)</span>                <span class="c1"># (1,1) and (2,1) in `a&#39; are less</span>
      <span class="p">[,</span><span class="m">1</span><span class="p">]</span>  <span class="p">[,</span><span class="m">2</span><span class="p">]</span>  <span class="p">[,</span><span class="m">3</span><span class="p">]</span>  <span class="p">[,</span><span class="m">4</span><span class="p">]</span>       <span class="c1">#  than 3, and (2,4) and (3,4) in</span>
<span class="p">[</span><span class="m">1</span><span class="p">,]</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>       <span class="c1">#  `b&#39; are less than 3; | returns</span>
<span class="p">[</span><span class="m">2</span><span class="p">,]</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>       <span class="c1">#  a matrix with `TRUE&#39; in (1,1),</span>
<span class="p">[</span><span class="m">3</span><span class="p">,]</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>       <span class="c1">#  (2,1), (2,4), and (3,4).</span>
</pre></div>
</div>
</li>
</ul>
<p>The &amp;&amp; (if and only if) and || (either or) operators are used to
control the command flow within functions. The &amp;&amp; operator returns a
TRUE only if every element in the comparison statement is true; the ||
operator returns a TRUE if any of the elements are true. Unlike the &amp;
and | operators, which return arrays of logical values, the &amp;&amp; and ||
operators return only one logical statement irrespective of the
dimensions of the objects under consideration. Hence, &amp;&amp; and || are
logical operators which are <em>not</em> appropriate for recoding variables.</p>
</div>
<div class="section" id="coding-and-recoding-variables">
<h5>Coding and Recoding Variables<a class="headerlink" href="#coding-and-recoding-variables" title="Permalink to this headline">¶</a></h5>
<p>R uses vectors of logical statements to indicate how a variable should
be coded or recoded. For example, to create a new variable var3 equal to
1 if var1  var2 and 0 otherwise:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var3 <span class="o">&lt;-</span> var1 <span class="o">&lt;</span> var2               <span class="c1"># Creates a vector of n T/F observations.</span>
<span class="o">&gt;</span> var3 <span class="o">&lt;-</span> as.integer<span class="p">(</span>var3<span class="p">)</span>          <span class="c1"># Replaces the T/F values in `var3&#39; with</span>
                                    <span class="c1">#  1&#39;s for TRUE and 0&#39;s for FALSE.</span>
<span class="o">&gt;</span> var3 <span class="o">&lt;-</span> as.integer<span class="p">(</span>var1 <span class="o">&lt;</span> var2<span class="p">)</span>   <span class="c1"># Combine the two steps above into one.</span>
</pre></div>
</div>
<p>In addition to generating a vector of dummy variables, you can also
refer to specific values using logical operators defined in . For
example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> v1 <span class="o">&lt;-</span> var1 <span class="o">==</span> <span class="m">5</span>                     <span class="c1"># Creates a vector of T/F statements.</span>
<span class="o">&gt;</span> var1<span class="p">[</span>v1<span class="p">]</span> <span class="o">&lt;-</span> <span class="m">4</span>                       <span class="c1"># For every TRUE in `v1&#39;, replaces the</span>
                                      <span class="c1">#  value in `var1&#39; with a 4.</span>
<span class="o">&gt;</span> var1<span class="p">[</span>var1 <span class="o">==</span> <span class="m">5</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">4</span>                <span class="c1"># The same, in one step.</span>
</pre></div>
</div>
<p>The index (inside the square brackets) can be created with reference to
other variables. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var1<span class="p">[</span>var2 <span class="o">==</span> var3<span class="p">]</span> <span class="o">&lt;-</span> <span class="m">1</span>
</pre></div>
</div>
<p>replaces the th value in var1 with a 1 when the th
value in var2 equals the th value in var3. If you use = in
place of ==, however, you will replace all the values in var1 with 1’s
because = is another way to assign variables. Thus, the statement var2 =
var3 is of course true.</p>
<p>Finally, you may also replace any (character, numerical, or logical)
values with special values (most commonly, NA).</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var1<span class="p">[</span>var1 <span class="o">==</span> <span class="s">&quot;don&#39;t know&quot;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>   <span class="c1"># Replaces all &quot;don&#39;t know&quot;&#39;s with NA&#39;s.</span>
</pre></div>
</div>
<p>After recoding the var1 replace the old data$var1 with the recoded var1:
data$var1 &lt;- var1. You may combine the recoding and replacement
procedures into one step. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="o">$</span>var1<span class="p">[</span>data<span class="o">$</span>var1 <span class="o">=&lt;</span> <span class="m">0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">-1</span>
</pre></div>
</div>
<p>Alternatively, rather than recoding just specific values in variables,
you may calculate new variables from existing variables. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> var3 <span class="o">&lt;-</span> var1 <span class="o">+</span> <span class="m">2</span> <span class="o">*</span> var2
<span class="o">&gt;</span> var3 <span class="o">&lt;-</span> log<span class="p">(</span>var1<span class="p">)</span>
</pre></div>
</div>
<p>After generating the new variables, use the assignment mechanism &lt;- to
insert the new variable into the data frame.</p>
<p>In addition to generating vectors of dummy variables, you may transform
a vector into a matrix of dummy indicator variables. For example, see to
transform a vector of  unique values (with 
observations in the complete vector) into a  matrix.</p>
</div>
<div class="section" id="missing-data">
<h5>Missing Data<a class="headerlink" href="#missing-data" title="Permalink to this headline">¶</a></h5>
<p>To deal with missing values in some of your variables:</p>
<ol class="arabic">
<li><p class="first">You may generate multiply imputed datasets using (or other programs).</p>
</li>
<li><p class="first">You may omit missing values. Zelig models automatically apply
list-wise deletion, so no action is required to run a model. To
obtain the total number of observations or produce other summary
statistics using the analytic dataset, you may manually omit
incomplete observations. To do so, first create a data frame
containing only the variables in your analysis. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> new.data <span class="o">&lt;-</span> cbind<span class="p">(</span>data<span class="o">$</span>dep.var<span class="p">,</span> data<span class="o">$</span>var1<span class="p">,</span> data<span class="o">$</span>var2<span class="p">,</span> data<span class="o">$</span>var3<span class="p">)</span>
</pre></div>
</div>
<p>The cbind() command “column binds” variables into a data frame. (A
similar command rbind() “row binds” observations with the same number
of variables into a data frame.) To omit missing values from this new
data frame:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> new.data <span class="o">&lt;-</span> na.omit<span class="p">(</span>new.data<span class="p">)</span>
</pre></div>
</div>
<p>If you perform na.omit() on the full data frame, you risk deleting
observations that are fully observed in your experimental variables,
but missing values in other variables. Creating a new data frame
containing only your experimental variables usually increases the
number of observations retained after na.omit().</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="section" id="statistical-commands">
<span id="userguide-statistical-commands"></span><h2><a class="toc-backref" href="#id32">Statistical Commands</a><a class="headerlink" href="#statistical-commands" title="Permalink to this headline">¶</a></h2>
<div class="section" id="zelig-commands">
<h3><a class="toc-backref" href="#id33">Zelig Commands</a><a class="headerlink" href="#zelig-commands" title="Permalink to this headline">¶</a></h3>
<div class="section" id="quick-overview">
<h4>Quick Overview<a class="headerlink" href="#quick-overview" title="Permalink to this headline">¶</a></h4>
<p>For any statistical model, Zelig does its work with a combination of
three commands.</p>
<ol class="arabic simple">
<li>Use <tt class="docutils literal"><span class="pre">zelig()</span></tt> to run the chosen statistical model on a given data
set, with a specific set of variables. For standard likelihood
models, for example, this step estimates the coefficients, other
model parameters, and a variance-covariance matrix. In addition, you
may choose from a variety of options:<ul>
<li>Pre-process data: Prior to calling zelig(), you may choose from a
variety of data pre-processing commands (matching or multiple
imputation, for example) to make your statistical inferences more
accurate.</li>
<li>Summarize model: After calling zelig(), you may summarize the
fitted model output using summary().</li>
<li>Validate model: After calling zelig(), you may choose to validate
the fitted model. This can be done, for example, by using
cross-validation procedures and diagnostics tools.</li>
</ul>
</li>
<li>Use <tt class="docutils literal"><span class="pre">setx()</span></tt> to set each of the explanatory variables to chosen
(actual or counterfactual) values in preparation for calculating
quantities of interest. After calling setx(), you may use to evaluate
these choices by determining whether they involve interpolation
(i.e., are inside the convex hull of the observed data) or
extrapolation, as well as how far these counterfactuals are from the
data. Counterfactuals chosen in <tt class="docutils literal"><span class="pre">setx()</span></tt> that involve extrapolation
far from the data can generate considerably more model dependence
(see , , ).</li>
<li>Use <tt class="docutils literal"><span class="pre">sim()</span></tt> to draw simulations of your quantity of interest (such
as a predicted value, predicted probability, risk ratio, or first
difference) from the model. (These simulations may be drawn using an
asymptotic normal approximation (the default), bootstrapping, or
other methods when available, such as directly from a Bayesian
posterior.) After calling sim(), use any of the following to
summarize the simulations:<ul>
<li>The summary() function gives a numerical display. For multiple
setx() values, summary() lets you summarize simulations by
choosing one or a subset of observations.</li>
<li>If the setx() values consist of only one observation, plot()
produces density plots for each quantity of interest.</li>
</ul>
</li>
</ol>
<p>Whenever possible, we use z.out as the zelig() output object, <tt class="docutils literal"><span class="pre">x.out</span></tt>
as the <tt class="docutils literal"><span class="pre">setx()</span></tt> output object, and s.out as the sim() output object,
but you may choose other names.</p>
</div>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Use the <tt class="docutils literal"><span class="pre">turnout</span></tt> data set included with Zelig to estimate a logit
model of an individual’s probability of voting as function of race
and age. Simulate the predicted probability of voting for a white
individual, with age held at its mean:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>vote <span class="o">~</span> race <span class="o">+</span> age<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;logit&quot;</span><span class="p">,</span> data <span class="o">=</span> turnout<span class="p">)</span>
<span class="o">&gt;</span> x.out <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> race <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> s.out <span class="o">&lt;-</span> sim<span class="p">(</span>z.out<span class="p">,</span> x <span class="o">=</span> x.out<span class="p">)</span>
<span class="o">&gt;</span> summary<span class="p">(</span>s.out<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Compute a first difference and risk ratio, changing education from 12
to 16 years, with other variables held at their means in the data:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>vote <span class="o">~</span> race <span class="o">+</span> educate<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;logit&quot;</span><span class="p">,</span> data <span class="o">=</span> turnout<span class="p">)</span>
<span class="o">&gt;</span> x.low <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> educate <span class="o">=</span> <span class="m">12</span><span class="p">)</span>
<span class="o">&gt;</span> x.high <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> educate <span class="o">=</span> <span class="m">16</span><span class="p">)</span>
<span class="o">&gt;</span> s.out <span class="o">&lt;-</span> sim<span class="p">(</span>z.out<span class="p">,</span> x <span class="o">=</span> x.low<span class="p">,</span> x1 <span class="o">=</span> x.high<span class="p">)</span>
<span class="o">&gt;</span> summary<span class="p">(</span>s.out<span class="p">)</span>                                     <span class="c1"># Numerical summary.</span>
<span class="o">&gt;</span> plot<span class="p">(</span>s.out<span class="p">)</span>                                        <span class="c1"># Graphical summary.</span>
</pre></div>
</div>
</li>
<li><p class="first">Calculate expected values for every observation in your data set:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>vote <span class="o">~</span> race <span class="o">+</span> educate<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;logit&quot;</span><span class="p">,</span> data <span class="o">=</span> turnout<span class="p">)</span>
<span class="o">&gt;</span> x.out <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> fn <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span>
<span class="o">&gt;</span> s.out <span class="o">&lt;-</span> sim<span class="p">(</span>z.out<span class="p">,</span> x <span class="o">=</span> x.out<span class="p">)</span>
<span class="o">&gt;</span> summary<span class="p">(</span>s.out<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Use five multiply imputed data sets from in an ordered logit model:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> data<span class="p">(</span>immi1<span class="p">,</span> immi2<span class="p">,</span> immi3<span class="p">,</span> immi4<span class="p">,</span> immi5<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>as.factor<span class="p">(</span>ipip<span class="p">)</span> <span class="o">~</span> wage1992 <span class="o">+</span> prtyid <span class="o">+</span> ideol<span class="p">,</span>
                 model <span class="o">=</span> <span class="s">&quot;ologit&quot;</span><span class="p">,</span>
                 data <span class="o">=</span> mi<span class="p">(</span>immi1<span class="p">,</span> immi2<span class="p">,</span> immi3<span class="p">,</span> immi4<span class="p">,</span> immi5<span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the nearest propensity score matching via <em>MatchIt</em> package, and
then calculate the conditional average treatment effect of the job
training program based on the linear regression model:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>MatchIt<span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>lalonde<span class="p">)</span>
<span class="o">&gt;</span> m.out <span class="o">&lt;-</span> matchit<span class="p">(</span>treat <span class="o">~</span> re74 <span class="o">+</span> re75 <span class="o">+</span> educ <span class="o">+</span> black <span class="o">+</span> hispan <span class="o">+</span> age<span class="p">,</span>
                   data <span class="o">=</span> lalonde<span class="p">,</span> method <span class="o">=</span> <span class="s">&quot;nearest&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> m.data <span class="o">&lt;-</span> match.data<span class="p">(</span>m.out<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>re78 <span class="o">~</span> treat <span class="o">+</span> distance <span class="o">+</span> re74 <span class="o">+</span> re75 <span class="o">+</span> educ <span class="o">+</span> black <span class="o">+</span>
                 hispan <span class="o">+</span> age<span class="p">,</span> data <span class="o">=</span> m.data<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;ls&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> x.out0 <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> fn <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> treat <span class="o">=</span> <span class="m">0</span><span class="p">)</span>
<span class="o">&gt;</span> x.out1 <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> fn <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> treat <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
<span class="o">&gt;</span> s.out <span class="o">&lt;-</span> sim<span class="p">(</span>z.out<span class="p">,</span> x<span class="o">=</span>x.out0<span class="p">,</span> x1<span class="o">=</span>x.out1<span class="p">)</span>
<span class="o">&gt;</span> summary<span class="p">(</span>s.out<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Validate the fitted model using the leave-one-out cross validation
procedure and calculating the average squared prediction error via
<em>boot</em> package. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>boot<span class="p">)</span>
<span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>
<span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>vote <span class="o">~</span> race <span class="o">+</span> educate<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;logit&quot;</span><span class="p">,</span> data <span class="o">=</span> turnout<span class="p">,</span> cite<span class="o">=</span><span class="k-Variable">F</span><span class="p">)</span>
<span class="o">&gt;</span> cv.out <span class="o">&lt;-</span> cv.glm<span class="p">(</span>z.out<span class="p">,</span> data <span class="o">=</span> turnout<span class="p">,</span> k<span class="o">=</span><span class="m">11</span><span class="p">)</span>
<span class="o">&gt;</span> print<span class="p">(</span>cv.out<span class="o">$</span>delta<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="details">
<h4>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">z.out &lt;- zelig(formula, model, data, by = NULL, …)</p>
<p>The zelig() command estimates a selected statistical model given the
specified data. You may name the output object (<tt class="docutils literal"><span class="pre">z.out</span></tt> above)
anything you desire. You must include three required arguments, in
the following order:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">formula</span></tt> takes the form y ~ x1 + x2, where y is the dependent
variable and x1 and x2 are the explanatory variables, and y, x1,
and x2 are contained in the same dataset. The + symbol means
“inclusion” not “addition.” You may include interaction terms in
the form of x1*x2 without having to compute them in prior steps
or include the main effects separately. For example, R treats the
formula y ~ x1*x2 as y ~ x1 + x2 + x1*x2. To prevent R from
automatically including the separate main effect terms, use the
I() function, thus: y ~ I(x1 * x2).</li>
<li><tt class="docutils literal"><span class="pre">model</span></tt> lets you choose which statistical model to run. You must
put the name of the model in quotation marks, in the form model =
“ls”, for example. See for a list of currently supported models.</li>
<li><tt class="docutils literal"><span class="pre">data</span></tt> specifies the data frame containing the variables called
in the formula, in the form data = mydata. Alternatively, you may
input multiply imputed datasets in the form data = mi(data1,
data2, …). <a href="#id53"><span class="problematic" id="id54"><span id="id5"></span>[1]_</span></a> If you are working with matched data created using
, you may create a data frame within the zelig() statement by
using data = match.data(…). In all cases, the data frame or
MatchIt object must have been previously loaded into the working
memory.</li>
<li>by (an optional argument which is by default NULL) allows you to
choose a factor variable (see ) in the data frame as a subsetting
variable. For each of the unique strata defined in the by
variable, zelig() does a separate run of the specified model. The
variable chosen should <em>not</em> be in the formula, because there will
be no variance in the by variable in the subsets. If you have one
data set for all 191 countries in the UN, for example, you may use
the by option to run the same model 191 times, once on each
country, all with a single zelig() statement. You may also use the
by option to run models on subclasses.</li>
<li>The output object, z.out, contains all of the options chosen,
including the name of the data set. Because data sets may be
large, Zelig does not store the full data set, but only the name
of the dataset. Every time you use a Zelig function, it looks for
the dataset with the appropriate name in working memory. (Thus, it
is critical that you do <em>not</em> change the name of your data set, or
perform any additional operations on your selected variables
between calling zelig() and setx(), or between setx() and sim().)</li>
<li>If you would like to view the regression output at this
intermediate step, type summary(z.out) to return the coefficients,
standard errors, -statistics and -values. We
recommend instead that you calculate quantities of interest;
creating z.out is only the first of three steps in this task.</li>
</ol>
</li>
<li><p class="first">x.out &lt;- setx(z.out, fn = list(numeric = mean, ordered = median,
others = mode), data = NULL, cond = FALSE, …)</p>
<p>The setx() command lets you choose values for the explanatory
variables, with which sim() will simulate quantities of interest.
There are two types of setx() procedures:</p>
<ul>
<li><p class="first">You may perform the usual <em>unconditional</em> prediction (by default,
cond = FALSE), by explicitly choosing the values of each
explanatory variable yourself or letting setx() compute them,
either from the data used to create z.out or from a new data set
specified in the optional data argument. You may also compute
predictions for all observed values of your explanatory variables
using fn = NULL.</p>
</li>
<li><p class="first">Alternatively, for advanced uses, you may perform <em>conditional</em>
prediction (cond = TRUE), which predicts certain quantities of
interest by conditioning on the observed value of the dependent
variable. In a simple linear regression model, this procedure is
not particularly interesting, since the conditional prediction is
merely the observed value of the dependent variable for that
observation. However, conditional prediction is extremely useful
for other models and methods, including the following:</p>
<ul class="simple">
<li>In a matched sampling design, the sample average treatment
effect for the treated can be estimated by computing the
difference between the observed dependent variable for the
treated group and their expected or predicted values of the
dependent variable under no treatment .</li>
<li>With censored data, conditional prediction will ensure that all
predicted values are greater than the censored observed values
.</li>
<li>In ecological inference models, conditional prediction
guarantees that the predicted values are on the tomography line
and thus restricted to the known bounds .</li>
<li>The conditional prediction in many linear random effects (or
Bayesian hierarchical) models is a weighted average of the
unconditional prediction and the value of the dependent
variable for that observation, with the weight being an
estimable function of the accuracy of the unconditional
prediction . When the unconditional prediction is highly
certain, the weight on the value of the dependent variable for
this observation is very small, hence reducing inefficiency;
when the unconditional prediction is highly uncertain, the
relative weight on the unconditional prediction is very small,
hence reducing bias. Although the simple weighted average
expression no longer holds in nonlinear models, the general
logic still holds and the mean square error of the measurement
is typically reduced .</li>
</ul>
<p>In these and other models, conditioning on the observed value of
the dependent variable can vastly increase the accuracy of
prediction and measurement.</p>
</li>
</ul>
<p>The setx() arguments for <strong>unconditional</strong> prediction are as follows:</p>
<ol class="arabic">
<li><p class="first">z.out, the zelig() output object, must be included first.</p>
</li>
<li><p class="first">You can set particular explanatory variables to specified values.
For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>vote <span class="o">~</span> age <span class="o">+</span> race<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;logit&quot;</span><span class="p">,</span> data <span class="o">=</span> turnout<span class="p">)</span>
<span class="o">&gt;</span> x.out <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> age <span class="o">=</span> <span class="m">30</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">setx()</span></tt> sets the variables <em>not</em> explicitly listed to their
mean if numeric, and their median if ordered factors, and their
mode if unordered factors, logical values, or character strings.
Alternatively, you may specify one explanatory variable as a range
of values, creating one observation for every unique value in the
range of values: <a href="#id55"><span class="problematic" id="id56"><span id="id6"></span>[2]_</span></a></p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x.out <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> age <span class="o">=</span> <span class="m">18</span><span class="o">:</span><span class="m">95</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates 78 observations with with age set to 18 in the first
observation, 19 in the second observation, up to 95 in the 78th
observation. The other variables are set to their default values,
but this may be changed by setting fn, as described next.</p>
</li>
<li><p class="first">Optionally, <tt class="docutils literal"><span class="pre">fn</span></tt> is a list which lets you to choose a different
function to apply to explanatory variables of class</p>
<ul class="simple">
<li>numeric, which is mean by default,</li>
<li>ordered factor, which is median by default, and</li>
<li>other variables, which consist of logical variables, character
string, and unordered factors, and are set to their mode by
default.</li>
</ul>
<p>While any function may be applied to numeric variables, mean will
default to median for ordered factors, and mode is the only
available option for other types of variables. In the special
case, fn = NULL, setx() returns all of the observations.</p>
</li>
<li><p class="first">You cannot perform other math operations within the fn argument,
but can use the output from one call of setx to create new values
for the explanatory variables. For example, to set the explanatory
variables to one standard deviation below their mean:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> X.sd <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> fn <span class="o">=</span> list<span class="p">(</span>numeric <span class="o">=</span> sd<span class="p">))</span>
<span class="o">&gt;</span> X.mean <span class="o">&lt;-</span> setx<span class="p">(</span>z.out<span class="p">,</span> fn <span class="o">=</span> list<span class="p">(</span>numeric <span class="o">=</span> mean<span class="p">))</span>
<span class="o">&gt;</span> x.out <span class="o">&lt;-</span> X.mean <span class="o">-</span> X.sd
</pre></div>
</div>
</li>
<li><p class="first">Optionally, <tt class="docutils literal"><span class="pre">data</span></tt> identifies a new data frame (rather than the
one used to create z.out) from which the setx() values are
calculated. You can use this argument to set values of the
explanatory variables for hold-out or out-of-sample fit tests.</p>
</li>
<li><p class="first">The cond is always FALSE for unconditional prediction.</p>
</li>
</ol>
<p>If you wish to calculate risk ratios or first differences, call
setx() a second time to create an additional set of the values for
the explanatory variables. For example, continuing from the example
above, you may create an alternative set of explanatory variables
values one standard deviation above their mean:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x.alt <span class="o">&lt;-</span> X.mean <span class="o">+</span> X.sd
</pre></div>
</div>
<p>The required arguments for <strong>conditional</strong> prediction are as follows:</p>
<ol class="arabic simple">
<li>z.out, the zelig() output object, must be included first.</li>
<li>fn, which equals NULL to indicate that all of the observations are
selected. You may only perform conditional inference on actual
observations, not the mean of observations or any other function
applied to the observations. Thus, if fn is missing, but cond =
TRUE, setx() coerces fn = NULL.</li>
<li>data, the data for conditional prediction.</li>
<li>cond, which equals TRUE for conditional prediction.</li>
</ol>
<p>Additional arguments, such as any of the variable names, are ignored
in conditional prediction since the actual values of that observation
are used.</p>
</li>
<li><p class="first">s.out &lt;- sim(z.out, x = x.out, x1 = NULL, num = c(1000, 100),
bootstrap = FALSE, bootfn = NULL, …)</p>
<p>The sim() command simulates quantities of interest given the output
objects from <tt class="docutils literal"><span class="pre">zelig()</span></tt> and <tt class="docutils literal"><span class="pre">setx()</span></tt>. This procedure uses only the
assumptions of the statistical model. The sim() command performs
either unconditional or conditional prediction depending on the
options chosen in setx().</p>
<p>The arguments are as follows for <strong>unconditional</strong> prediction:</p>
<ol class="arabic">
<li><p class="first">z.out, the model output from zelig().</p>
</li>
<li><p class="first">x, the output from the setx() procedure performed on the model
output.</p>
</li>
<li><p class="first">Optionally, you may calculate first differences by specifying x1,
an additional setx() object. For example, using the x.out and
x.alt, you may generate first differences using:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> s.out <span class="o">&lt;-</span> sim<span class="p">(</span>z.out<span class="p">,</span> x <span class="o">=</span> x.out<span class="p">,</span> x1 <span class="o">=</span> x.alt<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">By default, the number of simulations, num, equals 1000 (or 100
simulations if bootstrap is selected), but this may be decreased
to increase computational speed, or increased for additional
precision.</p>
</li>
<li><p class="first">Zelig simulates parameters from classical <em>maximum likelihood</em>
models using asymptotic normal approximation to the
log-likelihood. This is the same assumption as used for
frequentist hypothesis testing (which is of course equivalent to
the asymptotic approximation of a Bayesian posterior with improper
uniform priors). See . For <em>Bayesian models</em>, Zelig simulates
quantities of interest from the posterior density, whenever
possible. For <em>robust Bayesian models</em>, simulations are drawn from
the identified class of Bayesian posteriors.</p>
</li>
<li><p class="first">Alternatively, you may set bootstrap = TRUE to simulate parameters
using bootstrapped data sets. If your dataset is large, bootstrap
procedures will usually be more memory intensive and
time-consuming than simulation using asymptotic normal
approximation. The type of bootstrapping (including the sampling
method) is determined by the optional argument bootfn, described
below.</p>
</li>
<li><p class="first">If bootstrap = TRUE is selected, sim() will bootstrap parameters
using the default bootfn, which re-samples from the data frame
with replacement to create a sampled data frame of the same number
of observations, and then re-runs zelig() (inside sim()) to create
one set of bootstrapped parameters. Alternatively, you may create
a function outside the sim() procedure to handle different
bootstrap procedures. Please consult help(boot) for more
details. <a class="footnote-reference" href="#id15" id="id7">[3]</a></p>
</li>
</ol>
<p>For <strong>conditional</strong> prediction, sim() takes only two required
arguments:</p>
<ol class="arabic simple">
<li>z.out, the model output from zelig().</li>
<li>x, the conditional output from setx().</li>
<li>Optionally, for duration models, cond.data, which is the data
argument from setx(). For models for duration dependent variables
(see ), sim() must impute the uncensored dependent variables
before calculating the average treatment effect. Inputting the
cond.data allows sim() to generate appropriate values.</li>
</ol>
<p>Additional arguments are ignored or generate error messages.</p>
</li>
</ol>
<div class="section" id="presenting-results">
<h5>Presenting Results<a class="headerlink" href="#presenting-results" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">Use summary(s.out) to print a summary of your simulated quantities.
You may specify the number of significant digits as:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> print<span class="p">(</span>summary<span class="p">(</span>s.out<span class="p">),</span> digits <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Alternatively, you can plot your results using <tt class="docutils literal"><span class="pre">plot(s.out)</span></tt>.</p>
</li>
<li><p class="first">You can also use <tt class="docutils literal"><span class="pre">names(s.out)</span></tt> to see the names and a description
of the elements in this object and the $ operator to extract
particular results. For most models, these are: s.out$qi$pr (for
predicted values), s.out$qi$ev (for expected values), and s.out$qi$fd
(for first differences in expected values). For the logit, probit,
multinomial logit, ordinal logit, and ordinal probit models,
quantities of interest also include s.out$qi$rr (the risk ratio).</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="describe-a-models-systematic-and-stochastic-parameters">
<h3><a class="toc-backref" href="#id34">Describe a model’s systematic and stochastic parameters</a><a class="headerlink" href="#describe-a-models-systematic-and-stochastic-parameters" title="Permalink to this headline">¶</a></h3>
<p>In order to use parse.formula(), parse.par(), and the
model.*.multiple() commands, you must write a describe.mymodel()
function where mymodel is the name of your modeling function. (Hence, if
your function is called normal.regression(), you need to write a
describe.normal.regression() function.) Note that describe() is <em>not</em> a
generic function, but is called by parse.formula(…, model = “mymodel”)
using a combination of paste() and exists(). You will never need to call
describe.mymodel() directly, since it will be called from
parse.formula() as that function checks the user-input formula or list
of formulas.</p>
<div class="highlight-r"><div class="highlight"><pre>describe.mymodel<span class="p">()</span>
</pre></div>
</div>
<p>The describe.mymodel() function takes no arguments.</p>
<p>The describe.mymodel() function returns a list with the following
information:</p>
<ul>
<li><p class="first">category: a character string, consisting of one of the following:</p>
<ul class="simple">
<li>“continuous”: the dependent variable is continuous, numeric, and
unbounded (e.g., normal regression), but may be censored with an
associated censoring indicator (e.g., tobit regression).</li>
<li>“dichotomous”: the dependent variable takes two discrete integer
values, usually 0 and 1 (e.g., logistic regression).</li>
<li>“ordinal”: the dependent variable is an ordered factor response,
taking 3 or more discrete values which are arranged in an
ascending or descending manner (e.g., ordered logistic
regression).</li>
<li>“multinomial”: the dependent variable is an unordered factor
response, taking 3 or more discrete values which are arranged in
no particular order (e.g., multinomial logistic regression).</li>
<li>“count”: the dependent variable takes integer values greater than
or equal to 0 (e.g., Poisson regression).</li>
<li>“bounded”: the dependent variable is a continuous numeric
variable, that is restricted (bounded within) some range (e.g.,
). The variable may also be censored either on
the left and/or right side, with an associated censoring indicator
(e.g., Weibull regression).</li>
<li>“mixed”: the dependent variables are a mix of the above categories
(usually applies to multiple equation models).</li>
</ul>
<p>Selecting the category is particularly important since it sets
certain interface parameters for the entire GUI.</p>
</li>
<li><p class="first">package: (optional) a list with the following elements</p>
<ul>
<li><p class="first">name: a characters string with the name of the package containing
the mymodel() function.</p>
</li>
<li><p class="first">version: the minimum version number that works with Zelig.</p>
</li>
<li><p class="first">CRAN: if the package is not hosted on CRAN mirrors, provide the
URL here as a character string. You should be able to install your
package from this URL using name, version, and CRAN:</p>
<div class="highlight-r"><div class="highlight"><pre>install.packages<span class="p">(</span>name<span class="p">,</span> repos <span class="o">=</span> CRAN<span class="p">,</span> installWithVers <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, CRAN = “<a class="reference external" href="http://cran.us.r-project.org/">http://cran.us.r-project.org/</a>”.</p>
</li>
</ul>
</li>
<li><p class="first">parameters: For each systematic and stochastic parameter (or set of
parameters) in your model, you should create a list (named after the
parameters as given in your model’s notation, e.g., mu, sigma, theta,
etc.; not literally myparameter) with the following information:</p>
<ul class="simple">
<li>equations: an integer number of equations for the parameter. For
parameters that can take an undefined number of equations (for
example in seemingly unrelated regression), use c(2, Inf) or c(2,
999) to indicate that the parameter can take a minimum of two
equations up to a theoretically infinite number of equations.</li>
<li>tagsAllowed: a logical value (TRUE/FALSE) specifying whether a
given parameter allows constraints. If there is only one equation
for a parameter (for example, mu for the normal regression model
has equations = 1), then tagsAllowed = FALSE by default. If there
are two or more equations for the parameter (for example, mu for
the bivariate probit model has equations = 2), then tagsAllowed =
TRUE by default.</li>
<li>depVar: a logical value (TRUE/FALSE) specifying whether a
parameter requires a corresponding dependent variable.</li>
<li>expVar: a logical value (TRUE/FALSE) specifying whether a
parameter allows explanatory variables. If depVar = TRUE and
expVar = TRUE, we call the parameter a “systematic component” and
parse.formula() will fail if formula(s) are not specified for this
parameter. If depVar = FALSE and expVar = TRUE, the parameter is
estimated as a scalar ancillary parameter, with default formula
<tt class="docutils literal"><span class="pre">~</span> <span class="pre">1</span></tt>, if the user does not specify a formula explicitly. If
depVar = FALSE and expVar = FALSE, the parameter can only be
estimated as a scalar ancillary parameter.</li>
<li>specialFunction: (optional) a character string giving the name of
a function that appears on the left-hand side of the formula.
Options include “Surv”, “cbind”, and “as.factor”.</li>
<li>varInSpecial: (optional) a scalar or vector giving the number of
variables taken by the specialFunction. For example, Surv() takes
a minimum of 2 arguments, and a maximum of 4 arguments, which is
represented as c(2, 4).</li>
</ul>
<p>If you have more than one parameter (or set of parameters) in your
model, you will need to produce a myparameter list for each one. See
examples below for details.</p>
</li>
</ul>
<p>For a Normal regression model with mean mu and scalar variance parameter
sigma2, the minimal describe.*() function is as follows:</p>
<div class="highlight-r"><div class="highlight"><pre>describe.normal.regression <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
  category <span class="o">&lt;-</span> <span class="s">&quot;continuous&quot;</span>
  mu <span class="o">&lt;-</span> list<span class="p">(</span>equations <span class="o">=</span> <span class="m">1</span><span class="p">,</span>              <span class="c1"># Systematic component</span>
             tagsAllowed <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
             depVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             expVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  sigma2 <span class="o">&lt;-</span> list<span class="p">(</span>equations <span class="o">=</span> <span class="m">1</span><span class="p">,</span>          <span class="c1"># Scalar ancillary parameter</span>
                 tagsAllowed <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
                 depVar <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>
                 expVar <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
  pars <span class="o">&lt;-</span> list<span class="p">(</span>mu <span class="o">=</span> mu<span class="p">,</span> sigma2 <span class="o">=</span> sigma2<span class="p">)</span>
  model <span class="o">&lt;-</span> list<span class="p">(</span>category <span class="o">=</span> category<span class="p">,</span> parameters <span class="o">=</span> pars<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See for full code to execute this model from scratch in R with Zelig.</p>
<p>Now consider a bivariate probit model with parameter vector mu and
correlation parameter rho (which may or may not take explanatory
variables). Since the bivariate probit function uses the pmvnorm()
function from the mvtnorm library, we list this under package.</p>
<div class="highlight-r"><div class="highlight"><pre>describe.bivariate.probit <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
  category <span class="o">&lt;-</span> <span class="s">&quot;dichotomous&quot;</span>
  package <span class="o">&lt;-</span> list<span class="p">(</span>name <span class="o">=</span> <span class="s">&quot;mvtnorm&quot;</span><span class="p">,</span>
                  version <span class="o">=</span> <span class="s">&quot;0.7&quot;</span><span class="p">)</span>
  mu <span class="o">&lt;-</span> list<span class="p">(</span>equations <span class="o">=</span> <span class="m">2</span><span class="p">,</span>               <span class="c1"># Systematic component</span>
             tagsAllowed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             depVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             expVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  rho <span class="o">&lt;-</span> list<span class="p">(</span>equations <span class="o">=</span> <span class="m">1</span><span class="p">,</span>              <span class="c1"># Optional systematic component</span>
             tagsAllowed <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>         <span class="c1">#   Estimated as an ancillary</span>
             depVar <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span>              <span class="c1">#   parameter by default</span>
             expVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  pars <span class="o">&lt;-</span> list<span class="p">(</span>mu <span class="o">=</span> mu<span class="p">,</span> rho <span class="o">=</span> rho<span class="p">)</span>
  list<span class="p">(</span>category <span class="o">=</span> category<span class="p">,</span> package <span class="o">=</span> package<span class="p">,</span> parameters <span class="o">=</span> pars<span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See for the full code to write this model from scratch in R with Zelig.</p>
<p>For a multinomial logit model, which takes an undefined number of
equations (corresponding to each level in the response variable):</p>
<div class="highlight-r"><div class="highlight"><pre>describe.multinomial.logit <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">()</span> <span class="p">{</span>
  category <span class="o">&lt;-</span> <span class="s">&quot;multinomial&quot;</span>
  mu <span class="o">&lt;-</span> list<span class="p">(</span>equations <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kc">Inf</span><span class="p">),</span>
             tagsAllowed <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             depVAR <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             expVar <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span>
             specialFunction <span class="o">&lt;-</span> <span class="s">&quot;as.factor&quot;</span><span class="p">,</span>
             varInSpecial <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">))</span>
  list<span class="p">(</span>category <span class="o">=</span> category<span class="p">,</span> parameters <span class="o">=</span> list<span class="p">(</span>mu <span class="o">=</span> mu<span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(This example does not have corresponding executable sample code.)</p>
<ul class="simple">
<li>for an overview of how the describe.*() function works with
parse.formula().</li>
</ul>
<p>Kosuke Imai, Gary King, Olivia Lau, and Ferdinand Alimadhi.</p>
</div>
<div class="section" id="supported-models">
<h3><a class="toc-backref" href="#id35">Supported Models</a><a class="headerlink" href="#supported-models" title="Permalink to this headline">¶</a></h3>
<p>We list here all models implemented in Zelig, organized by the nature of
the dependent variable(s) to be predicted, explained, or described.</p>
<ol class="arabic">
<li><p class="first"><strong>Continuous Unbounded</strong> dependent variables can take any real value
in the range . While most of these models
take a continuous dependent variable, Bayesian factor analysis takes
multiple continuous dependent variables.</p>
<ol class="arabic simple">
<li>“ls”: The <em>linear least-squares</em> (see ) calculates the
coefficients that minimize the sum of squared residuals. This is
the usual method of computing linear regression coefficients, and
returns unbiased estimates of  and 
(conditional on the specified model).</li>
<li>“normal”: The <em>Normal</em> (see ) model computes the
maximum-likelihood estimator for a Normal stochastic component and
linear systematic component. The coefficients are identical to
<tt class="docutils literal"><span class="pre">ls</span></tt>, but the maximum likelihood estimator for 
is consistent but biased.</li>
<li>“normal.bayes”: The <em>Bayesian Normal</em> regression model () is
similar to maximum likelihood Gaussian regression, but makes valid
small sample inferences via draws from the exact posterior and
also allows for priors.</li>
<li>“netls”: The <em>network least squares</em> regression () is similar to
least squares regression for continuous-valued proximity matrix
dependent variables. Proximity matrices are also known as
sociomatrices, adjacency matrices, and matrix representations of
directed graphs.</li>
<li>“tobit”: The <em>tobit</em> regression model (see ) is a Normal
distribution with left-censored observations.</li>
<li>“tobit.bayes”: The <em>Bayesian tobit</em> distribution (see ) is a
Normal distribution that has either left and/or right censored
observations.</li>
<li>“arima”: Use <em>auto-regressive, integrated, moving-average</em> (ARIMA)
models for time series data (see .</li>
<li>“factor.bayes”: The <em>Bayesian factor analysis</em> model (see )
estimates multiple observed continuous dependent variables as a
function of latent explanatory variables.</li>
</ol>
</li>
<li><p class="first"><strong>Dichotomous</strong> dependent variables consist of two discrete values,
usually .</p>
<ol class="arabic simple">
<li>“logit”: <em>Logistic regression</em> (see ) specifies 
to be a(n inverse) logistic transformation of a linear function of
a set of explanatory variables.</li>
<li>“relogit”: The <em>rare events logistic</em> regression option (see )
estimates the same model as the logit, but corrects for bias due
to rare events (when one of the outcomes is much more prevalent
than the other). It also optionally uses prior correction to
correct for choice-based (case-control) sampling designs.</li>
<li>“logit.bayes”: <em>Bayesian logistic regression</em> (see ) is similar to
maximum likelihood logistic regression, but makes valid small
sample inferences via draws from the exact posterior and also
allows for priors.</li>
<li>“probit”: <em>Probit regression</em> (see ) Specifies  to
be a(n inverse) CDF normal transformation as a linear function of
a set of explanatory variables.</li>
<li>“probit.bayes”: <em>Bayesian probit</em> regression (see ) is similar to
maximum likelihood probit regression, but makes valid small sample
inferences via draws from the exact posterior and also allows for
priors.</li>
<li>“netlogit”: The <em>network logistic</em> regression () is similar to
logistic regression for binary-valued proximity matrix dependent
variables. Proximity matrices are also known as sociomatrices,
adjacency matrices, and matrix representations of directed graphs.</li>
<li>“blogit”: The <em>bivariate logistic</em> model (see ) models
 for
 according to a
bivariate logistic density.</li>
<li>“bprobit”: The <em>bivariate probit</em> model (see ) models
 for
 according to a
bivariate normal density.</li>
<li>“irt1d”: The <em>one-dimensional item response</em> model (see ) takes
multiple dichotomous dependent variables and models them as a
function of <em>one</em> latent (unobserved) explanatory variable.</li>
<li>“irtkd”: The <em>k-dimensional item response</em> model (see ) takes
multiple dichotomous dependent variables and models them as a
function of  latent (unobserved) explanatory variables.</li>
</ol>
</li>
<li><p class="first"><strong>Ordinal</strong> are used to model ordered, discrete dependent variables.
The values of the outcome variables (such as kill, punch, tap, bump)
are ordered, but the distance between any two successive categories
is not known exactly. Each dependent variable may be thought of as
linear, with one continuous, unobserved dependent variable observed
through a mechanism that only returns the ordinal choice.</p>
<ol class="arabic simple">
<li>“ologit”: The <em>ordinal logistic</em> model (see ) specifies the
stochastic component of the unobserved variable to be a standard
logistic distribution.</li>
<li>“oprobit”: The <em>ordinal probit</em> distribution (see ) specifies the
stochastic component of the unobserved variable to be standardized
normal.</li>
<li>“oprobit.bayes”: <em>Bayesian ordinal probit</em> model (see ) is similar
to ordinal probit regression, but makes valid small sample
inferences via draws from the exact posterior and also allows for
priors.</li>
<li>“factor.ord”: <em>Bayesian ordered factor analysis</em> (see ) models
observed, ordinal dependent variables as a function of latent
explanatory variables.</li>
</ol>
</li>
<li><p class="first"><strong>Multinomial</strong> dependent variables are unordered, discrete
categorical responses. For example, you could model an individual’s
choice among brands of orange juice or among candidates in an
election.</p>
<ol class="arabic simple">
<li>“mlogit”: The <em>multinomial logistic</em> model (see ) specifies
categorical responses distributed according to the multinomial
stochastic component and logistic systematic component.</li>
<li>“mlogit.bayes”: <em>Bayesian multinomial logistic</em> regression (see )
is similar to maximum likelihood multinomial logistic regression,
but makes valid small sample inferences via draws from the exact
posterior and also allows for priors.</li>
</ol>
</li>
<li><p class="first"><strong>Count</strong> dependent variables are non-negative integer values, such
as the number of presidential vetoes or the number of photons that
hit a detector.</p>
<ol class="arabic">
<li><p class="first">“poisson”: The <em>Poisson</em> model (see ) specifies the expected
number of events that occur in a given observation period to be an
exponential function of the explanatory variables. The Poisson
stochastic component has the property that,
:math:<a href="#id8"><span class="problematic" id="id9">`</span></a>lambda = textrm{E}(Y_i|X_i)</p>
<blockquote>
<div><p>= textrm{V}(Y_i|X_i)`.</p>
</div></blockquote>
</li>
<li><p class="first">“poisson.bayes”: <em>Bayesian Poisson</em> regression (see ) is similar
to maximum likelihood Poisson regression, but makes valid small
sample inferences via draws from the exact posterior and also
allows for priors.</p>
</li>
<li><p class="first">“negbin”: The <em>negative binomial</em> model (see ) has the same
systematic component as the Poisson, but allows event counts to be
over-dispersed, such that
.</p>
</li>
</ol>
</li>
<li><p class="first"><a href="#id10"><span class="problematic" id="id11">**</span></a>Continuous Bounded**[duration] dependent variables that are
continuous only over a certain range, usually . In
addition, some models (exponential, lognormal, and Weibull) are also
censored for values greater than some censoring point, such that the
dependent variable has some units fully observed and others that are
only partially observed (censored).</p>
<ol class="arabic simple">
<li>“gamma”: The <em>Gamma</em> model (see ) for positively-valued,
continuous dependent variables that are fully observed (no
censoring).</li>
<li>“exp”: The <em>exponential</em> model (see ) for right-censored dependent
variables assumes that the hazard function is constant over time.
For some variables, this may be an unrealistic assumption as
subjects are more or less likely to fail the longer they have been
exposed to the explanatory variables.</li>
<li>“weibull”: The <em>Weibull</em> model (see ) for right-censored dependent
variables relaxes the assumption of constant hazard by including
an additional scale parameter : If
, the risk of failure increases the longer the
subject has survived; if , the risk of failure
decreases the longer the subject has survived. While zelig()
estimates  by default, you may optionally fix
 at any value greater than 0. Fixing
 results in an exponential model.</li>
<li>“lognorm”: The <em>log-normal</em> model (see ) for right-censored
duration dependent variables specifies the hazard function
non-monotonically, with increasing hazard over part of the
observation period and decreasing hazard over another.</li>
</ol>
</li>
<li><p class="first"><strong>Mixed</strong> dependent variables include models that take more than one
dependent variable, where the dependent variables come from two or
more of categories above. (They do not need to be of a homogeneous
type.)</p>
<ol class="arabic simple">
<li>The <em>Bayesian mixed factor analysis</em> model, in contrast to the
Bayesian factor analysis model and ordinal factor analysis model,
can model both types of dependent variables as a function of
latent explanatory variables.</li>
</ol>
</li>
<li><p class="first"><strong>Ecological inference</strong> models estimate unobserved internal cell
values given contingency tables with observed row and column
marginals.</p>
<ol class="arabic simple">
<li>ei.hier: The <em>hierarchical ei</em> model (see ) produces estimates for
a cross-section of  tables.</li>
<li>ei.dynamic: <em>Quinn’s dynamic Bayesian ei</em> model (see ) estimates a
dynamic Bayesian model for  tables with temporal
dependence across tables.</li>
<li>ei.RxC: The  ei model (see ) estimates a
hierarchical Multinomial-Dirichlet ei model for contingency tables
with more than 2 rows or columns.</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="replication-procedures">
<h3><a class="toc-backref" href="#id36">Replication Procedures</a><a class="headerlink" href="#replication-procedures" title="Permalink to this headline">¶</a></h3>
<p>A large part of any statistical analysis is documenting your work such
that given the same data, anyone may replicate your results. In
addition, many journals require the creation and dissemination of
“replication data sets” in order that others may replicate your results
(see ). Whether you wish to create replication materials for your own
records, or contribute data to others as a companion to your published
work, Zelig makes this process easy.</p>
<div class="section" id="saving-replication-materials">
<h4>Saving Replication Materials<a class="headerlink" href="#saving-replication-materials" title="Permalink to this headline">¶</a></h4>
<p>Let mydata be your final data set, z.out be your zelig() output, and
s.out your sim() output. To save all of this in one file, type:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> save<span class="p">(</span>mydata<span class="p">,</span> z.out<span class="p">,</span> s.out<span class="p">,</span> file <span class="o">=</span> <span class="s">&quot;replication.RData&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This creates the file replication.RData in your working directory. You
may compress this file using zip or gzip tools.</p>
<p>If you have run several specifications, all of these estimates may be
saved in one .RData file. Even if you only created quantities of
interest from one of these models, you may still save all the
specifications in one file. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> save<span class="p">(</span>mydata<span class="p">,</span> z.out1<span class="p">,</span> z.out2<span class="p">,</span> s.out<span class="p">,</span> file <span class="o">=</span> <span class="s">&quot;replication.RData&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Although the .RData format can contain data sets as well as output
objects, it is not the most space-efficient way of saving large data
sets. In an uncompressed format, ASCII text files take up less space
than data in .RData format. (When compressed, text-formatted data is
still smaller than .RData-formatted data.) Thus, if you have more than
100,000 observations, you may wish to save the data set separately from
the Zelig output objects. To do this, use the write.table() command. For
example, if mydata is a data frame in your workspace, use
write.table(mydata, file = “mydata.tab”) to save this as a tab-delimited
ASCII text file. You may specify other delimiters as well; see
help.zelig(“write.table”) for options.</p>
</div>
<div class="section" id="replicating-analyses">
<h4>Replicating Analyses<a class="headerlink" href="#replicating-analyses" title="Permalink to this headline">¶</a></h4>
<p>If the data set and analyses are all saved in one .RData file, located
in your working directory, you may simply type:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> load<span class="p">(</span><span class="s">&quot;replication.RData&quot;</span><span class="p">)</span>                   <span class="c1"># Loads the replication file.</span>
<span class="o">&gt;</span> z.rep <span class="o">&lt;-</span> repl<span class="p">(</span>z.out<span class="p">)</span>                        <span class="c1"># To replicate the model only.</span>
<span class="o">&gt;</span> s.rep <span class="o">&lt;-</span> repl<span class="p">(</span>s.out<span class="p">)</span>                        <span class="c1"># To replicate the model and</span>
                                              <span class="c1">#  quantities of interest.</span>
</pre></div>
</div>
<p>By default, repl() uses the same options used to create the original
output object. Thus, if the original s.out object used bootstrapping
with 245 simulations, the s.rep object will similarly have 245
bootstrapped simulations. In addition, you may use the prev option when
replicating quantities of interest to reuse rather than recreate
simulated parameters. Type help.zelig(“repl”) to view the complete list
of options for repl().</p>
<p>If the data were saved in a text file, use read.table() to load the
data, and then replicate the analysis:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> dat <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&quot;mydata.tab&quot;</span><span class="p">,</span> header <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># Where `dat&#39; is the same</span>
<span class="o">&gt;</span> load<span class="p">(</span><span class="s">&quot;replication.RData&quot;</span><span class="p">)</span>                       <span class="c1">#   as the name used in</span>
<span class="o">&gt;</span> z.rep <span class="o">&lt;-</span> repl<span class="p">(</span>z.out<span class="p">)</span>                            <span class="c1">#   `z.out&#39;.</span>
<span class="o">&gt;</span> s.rep <span class="o">&lt;-</span> repl<span class="p">(</span>s.out<span class="p">)</span>
</pre></div>
</div>
<p>If you have problems loading the data, please refer to .</p>
<p>Finally, you may use the identical() command to ensure that the
replicated regression output is in every way identical to the original
zelig() output. <a class="footnote-reference" href="#id16" id="id12">[4]</a> For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> identical<span class="p">(</span>z.out<span class="o">$</span>coef<span class="p">,</span> z.rep<span class="o">$</span>coef<span class="p">)</span>              <span class="c1"># Checks the coefficients.</span>
</pre></div>
</div>
<p>Simulated quantities of interest will vary from the original quantities
if parameters are re-simulated or re-sampled. If you wish to use
identical() to verify that the quantities of interest are identical, you
may use</p>
<div class="highlight-r"><div class="highlight"><pre><span class="c1"># Re-use the parameters simulated (and stored) in the original sim() output.</span>
<span class="o">&gt;</span> s.rep <span class="o">&lt;-</span> repl<span class="p">(</span>s.out<span class="p">,</span> prev <span class="o">=</span> s.out<span class="o">$</span>par<span class="p">)</span>

<span class="c1"># Check that the expected values are identical.  You may do this for each qi.</span>
<span class="o">&gt;</span> identical<span class="p">(</span>s.out<span class="o">$</span>qi<span class="o">$</span>ev<span class="p">,</span> s.rep<span class="o">$</span>qi<span class="o">$</span>ev<span class="p">)</span>
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td>Multiple imputation is a method of dealing with missing values in
your data which is more powerful than the usual list-wise deletion
approach. You can create multiply imputed datasets with a program
such as ; see . [mi]</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[2]</td><td>If you allow more than one variable to vary at a time, you risk
confounding the predictive effect of the variables in question.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td>If you choose to create your own bootfn, it must include the the
following three arguments: data, the original data frame; one of the
sampling methods described in help(boot); and object, the original
zelig() output object. The alternative bootstrapping function must
sample the data, fit the model, and extract the model-specific
parameters.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id16" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id12">[4]</a></td><td>The identical() command checks that numeric values are identical to
the maximum number of decimal places (usually 16), and also checks
that the the two objects have the same class (numeric, character,
integer, logical, or factor). Refer to help(identical) for more
information.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="graphing-commands">
<span id="userguide-graphing-commands"></span><h2><a class="toc-backref" href="#id37">Graphing Commands</a><a class="headerlink" href="#graphing-commands" title="Permalink to this headline">¶</a></h2>
<p>R, and thus Zelig, can produce exceptionally beautiful plots. Many
built-in plotting functions exist, including scatter plots, line charts,
histograms, bar charts, pie charts, ternary diagrams, contour plots, and
a variety of three-dimensional graphs. If you desire, you can exercise a
high degree of control to generate just the right graphic. Zelig
includes several default plots for one-observation simulations for each
model. To view these plots on-screen, simply type plot(s.out), where
s.out is the output from sim(). Depending on the model chosen, plot()
will return different plots.</p>
<p>If you wish to create your own plots, this section reviews the most
basic procedures for creating and saving two-dimensional plots. R plots
material in two steps:</p>
<ol class="arabic simple">
<li>You must call an output device (discussed in ), select a type of
plot, draw a plotting region, draw axes, and plot the given data. At
this stage, you may also define axes labels, the plot title, and
colors for the plotted data. Step one is described in below.</li>
<li>Optionally, you may add points, lines, text, or a legend to the
existing plot. These commands are described in .</li>
</ol>
<div class="section" id="drawing-plots">
<h3><a class="toc-backref" href="#id38">Drawing Plots</a><a class="headerlink" href="#drawing-plots" title="Permalink to this headline">¶</a></h3>
<p>The most generic plotting command is <tt class="docutils literal"><span class="pre">plot()</span></tt>, which automatically
recognizes the type of R object(s) you are trying to plot and selects
the best type of plot. The most common graphs returned by <tt class="docutils literal"><span class="pre">plot()</span></tt> are
as follows:</p>
<ol class="arabic simple">
<li>If <tt class="docutils literal"><span class="pre">X</span></tt> is a variable of length , <tt class="docutils literal"><span class="pre">plot(X)</span></tt> returns a
scatter plot of  for . If X is
unsorted, this procedure produces a messy graph. Use
<tt class="docutils literal"><span class="pre">plot(sort(X))</span></tt> to arrange the plotted values of 
from smallest to largest.</li>
<li>With two numeric vectors <tt class="docutils literal"><span class="pre">X</span></tt> and <tt class="docutils literal"><span class="pre">Y</span></tt>, both of length ,
<tt class="docutils literal"><span class="pre">plot(X,</span> <span class="pre">Y)</span></tt> plots a scatter plot of each point 
for . Alternatively, if Z is an object with two
vectors, <tt class="docutils literal"><span class="pre">plot(Z)</span></tt> also creates a scatter plot.</li>
</ol>
<p>Optional arguments specific to <tt class="docutils literal"><span class="pre">plot</span></tt> include:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">main</span></tt> creates a title for the graph, and <tt class="docutils literal"><span class="pre">xlab</span></tt> and <tt class="docutils literal"><span class="pre">ylab</span></tt>
label the x and y axes, respectively. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;My Lovely Plot&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Explanatory Variable&quot;</span><span class="p">,</span>
     <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Dependent Variable&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">type</span></tt> controls the type of plot you request. The default is
<tt class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y,</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">p)</span></tt>, but you may choose among the following
types:</p>
<p>[!h]</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>“p”</td>
<td>points</td>
</tr>
<tr class="row-even"><td>“l”</td>
<td>lines</td>
</tr>
<tr class="row-odd"><td>“b”</td>
<td>both points and lines</td>
</tr>
<tr class="row-even"><td>“c”</td>
<td>lines drawn up to but not including the points</td>
</tr>
<tr class="row-odd"><td>“h”</td>
<td>histogram</td>
</tr>
<tr class="row-even"><td>“s”</td>
<td>a step function</td>
</tr>
<tr class="row-odd"><td>“n”</td>
<td>a blank plotting region ( with the axes specified)</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">If you choose type = “p”, R plots open circles by default. You can
change the type of point by specifying the pch argument. For example,
<tt class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y,</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">p,</span> <span class="pre">pch</span> <span class="pre">=</span> <span class="pre">19)</span></tt> creates a scatter-plot of filled
circles. Other options for pch include:</p>
<p>[!h]</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>19</td>
<td>solid circle (a disk)</td>
</tr>
<tr class="row-even"><td>20</td>
<td>smaller solid circle</td>
</tr>
<tr class="row-odd"><td>21</td>
<td>circle</td>
</tr>
<tr class="row-even"><td>22</td>
<td>square</td>
</tr>
<tr class="row-odd"><td>23</td>
<td>diamond</td>
</tr>
<tr class="row-even"><td>24</td>
<td>triangle pointed up</td>
</tr>
<tr class="row-odd"><td>25</td>
<td>triangle pointed down</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In addition, you can specify your own symbols by using, for example,
pch = “*” or pch = “.”.</p>
</li>
<li><p class="first">If you choose type = “l”, R plots solid lines by default. Use the
optional lty argument to set the line type. For example, plot(x, y,
type = “l”, lty = “dashed”) plots a dashed line. Other options are
dotted, dotdash, longdash, and twodash.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">col</span></tt> sets the color of the points, lines, or bars. For example,
<tt class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y,</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">b,</span> <span class="pre">pch</span> <span class="pre">=</span> <span class="pre">20,</span> <span class="pre">lty</span> <span class="pre">=</span> <span class="pre">dotted,</span> <span class="pre">col</span> <span class="pre">=</span> <span class="pre">violet)</span></tt> plots
small circles connected by a dotted line, both of which are violet.
(The axes and labels remain black.) Use <tt class="docutils literal"><span class="pre">colors()</span></tt> to see the full
list of available colors.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">xlim</span></tt> and ylim set the limits to the -axis and
-axis. For example,
<tt class="docutils literal"><span class="pre">plot(x,</span> <span class="pre">y,</span> <span class="pre">xlim</span> <span class="pre">=</span> <span class="pre">c(0,</span> <span class="pre">25),</span> <span class="pre">ylim</span> <span class="pre">=</span> <span class="pre">c(-15,</span> <span class="pre">5))</span></tt> sets range of the
-axis to [0, 25] and the range of the -axis to
.</p>
</li>
</ul>
<p>For additional plotting options, refer to help(par).</p>
</div>
<div class="section" id="adding-points-lines-and-legends-to-existing-plots">
<h3><a class="toc-backref" href="#id39">Adding Points, Lines, and Legends to Existing Plots</a><a class="headerlink" href="#adding-points-lines-and-legends-to-existing-plots" title="Permalink to this headline">¶</a></h3>
<p>Once you have created a plot, you can <em>add</em> points, lines, text, or a
legend. To place each of these elements, R uses coordinates defined in
terms of the x-axes and y-axes of the plot area, not coordinates defined
in terms of the the plotting window or device. For example, if your plot
has an x-axis with values between , and a y-axis with values between , you may add a
point at .</p>
<ul class="simple">
<li><strong>points()</strong> plots one or more sets of points. Use <tt class="docutils literal"><span class="pre">pch</span></tt> with
<tt class="docutils literal"><span class="pre">points</span></tt> to add points to an existing plot. For example,
<tt class="docutils literal"><span class="pre">points(P,</span> <span class="pre">Q,</span> <span class="pre">pch</span> <span class="pre">=</span> <span class="pre">.,</span> <span class="pre">col</span> <span class="pre">=</span> <span class="pre">forest</span> <span class="pre">green)</span></tt> plots each
 as tiny green dots.</li>
<li><strong>lines()</strong> joins the specified points with line segments. The
arguments <tt class="docutils literal"><span class="pre">col</span></tt> and <tt class="docutils literal"><span class="pre">lty</span></tt> may also be used. For example,
<tt class="docutils literal"><span class="pre">lines(X,</span> <span class="pre">Y,</span> <span class="pre">col</span> <span class="pre">=</span> <span class="pre">blue,</span> <span class="pre">lty</span> <span class="pre">=</span> <span class="pre">dotted)</span></tt> draws a blue dotted line
from each set of points  to the next.
Alternatively, <tt class="docutils literal"><span class="pre">lines</span></tt> also takes command output which specifies
 coordinates. For example, <tt class="docutils literal"><span class="pre">density(Z)</span></tt> creates a
vector of  and a vector of , and plot(density(Z))
draws the kernel density function.</li>
<li><strong>text()</strong> adds a character string at the specified set of
 coordinates. For example, text(5, 5, labels = “Key
Point”) adds the label “Key Point” at the plot location
. You may also choose the font using the font option,
the size of the font relative to the axis labels using the cex
option, and choose a color using the col option. The full list of
options may be accessed using help(text).</li>
<li><strong>legend()</strong> places a legend at a specified set of 
coordinates. Type demo(vertci) to see an example for legend().</li>
</ul>
</div>
<div class="section" id="saving-graphs-to-files">
<h3><a class="toc-backref" href="#id40">Saving Graphs to Files</a><a class="headerlink" href="#saving-graphs-to-files" title="Permalink to this headline">¶</a></h3>
<p>By default, R displays graphs in a window on your screen. To save R
plots to file (to include them in a paper, for example), preface your
plotting commands with:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> ps.options<span class="p">(</span>family <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;Times&quot;</span><span class="p">),</span> pointsize <span class="o">=</span> <span class="m">12</span><span class="p">)</span>
<span class="o">&gt;</span> postscript<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;mygraph.eps&quot;</span><span class="p">,</span> horizontal <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> paper <span class="o">=</span> <span class="s">&quot;special&quot;</span><span class="p">,</span>
             width <span class="o">=</span> <span class="m">6.25</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">)</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">ps.options()</span></tt> command sets the font type and size in the
output file, and the <tt class="docutils literal"><span class="pre">postscript</span></tt> command allows you to specify the
name of the file as well as several additional options. Using paper =
special allows you to specify the width and height of the encapsulated
postscript region in inches (6.25 inches long and 4 inches high, in this
case), and the statement <tt class="docutils literal"><span class="pre">horizontal</span> <span class="pre">=</span> <span class="pre">FALSE</span></tt> suppresses R’s default
landscape orientation. Alternatively, you may use pdf() instead of
postscript(). If you wish to select postscript options for .pdf output,
you may do so using options in pdf(). For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> pdf<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;mygraph.pdf&quot;</span><span class="p">,</span> width <span class="o">=</span> <span class="m">6.25</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;Times&quot;</span><span class="p">,</span>
<span class="o">+</span>     pointsize <span class="o">=</span> <span class="m">12</span><span class="p">)</span>
</pre></div>
</div>
<p>At the end of every plot, you should close your output device. The
command <tt class="docutils literal"><span class="pre">dev.off()</span></tt> stops writing and saves the <tt class="docutils literal"><span class="pre">.eps</span></tt> or .pdf file
to your working directory. If you forget to close the file, you will
write all subsequent plots to the same file, overwriting previous plots.
You may also use <tt class="docutils literal"><span class="pre">dev.off()</span></tt> to close on-screen plot windows.</p>
<p>To write multiple plots to the same file, you can use the following
options:</p>
<ul>
<li><p class="first">For plots on separate pages in the same .pdf document, use</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> pdf<span class="p">(</span>file <span class="o">=</span> <span class="s">&quot;mygraph.pdf&quot;</span><span class="p">,</span> width <span class="o">=</span> <span class="m">6.25</span><span class="p">,</span> height <span class="o">=</span> <span class="m">4</span><span class="p">,</span> family <span class="o">=</span> <span class="s">&quot;Times&quot;</span><span class="p">,</span>
<span class="o">+</span>     pointsize <span class="o">=</span> <span class="m">12</span><span class="p">,</span> onefile <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">For multiple plots on one page, initialize either a .pdf or .eps
file, then (before any plotting commands) type:</p>
<div class="highlight-r"><div class="highlight"><pre>par<span class="p">(</span>mfrow <span class="o">=</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>
</pre></div>
</div>
<p>This creates a grid that has two rows and four columns. Your plot
statements will populate the grid going across the first row, then
the second row, from left to right.</p>
</li>
</ul>
</div>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id41">Examples</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<div class="section" id="descriptive-plots-box-plots">
<h4>Descriptive Plots: Box-plots<a class="headerlink" href="#descriptive-plots-box-plots" title="Permalink to this headline">¶</a></h4>
<p><img alt="image" src="docs/figs/vertci" /></p>
<p>Using the sample <tt class="docutils literal"><span class="pre">turnout</span></tt> data set included with Zelig, the following
commands will produce the graph above.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>Zelig<span class="p">)</span>                             <span class="c1"># Loads the Zelig package.</span>
<span class="o">&gt;</span> data <span class="p">(</span>turnout<span class="p">)</span>                             <span class="c1"># Loads the sample data.</span>
<span class="o">&gt;</span> boxplot<span class="p">(</span>income <span class="o">~</span> educate<span class="p">,</span>                  <span class="c1"># Creates a boxplot with income</span>
<span class="o">+</span>  data <span class="o">=</span> turnout<span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;grey&quot;</span><span class="p">,</span> pch <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="p">,</span>  <span class="c1">#  as a function of education.</span>
<span class="o">+</span>  main <span class="o">=</span> <span class="s">&quot;Income as a Function of Years of Education&quot;</span><span class="p">,</span>
<span class="o">+</span>  xlab <span class="o">=</span> <span class="s">&quot;Education in Years&quot;</span><span class="p">,</span> ylab <span class="o">=</span> <span class="s">&quot;Income in \$10,000s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="density-plots-a-histogram">
<h4>Density Plots: A Histogram<a class="headerlink" href="#density-plots-a-histogram" title="Permalink to this headline">¶</a></h4>
<p>Histograms are easy ways to evaluate the density of a quantity of
interest.</p>
<p><img alt="image" src="docs/figs/vertci" /></p>
<p>Here’s the code to create this graph:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>Zelig<span class="p">)</span>                              <span class="c1"># Loads the Zelig package.</span>
<span class="o">&gt;</span> data<span class="p">(</span>turnout<span class="p">)</span>                               <span class="c1"># Loads the sample data set.</span>
<span class="o">&gt;</span> truehist<span class="p">(</span>turnout<span class="o">$</span>income<span class="p">,</span>  col <span class="o">=</span> <span class="s">&quot;wheat1&quot;</span><span class="p">,</span>   <span class="c1"># Calls the main plot, with</span>
<span class="o">+</span>      xlab <span class="o">=</span> <span class="s">&quot;Annual Income in $10,000s&quot;</span><span class="p">,</span>    <span class="c1">#  options.</span>
<span class="o">+</span>      main <span class="o">=</span> <span class="s">&quot;Histogram of Income&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> lines<span class="p">(</span>density<span class="p">(</span>turnout<span class="o">$</span>income<span class="p">))</span>              <span class="c1"># Adds the kernel density line.</span>
</pre></div>
</div>
</div>
<div class="section" id="advanced-examples">
<h4>Advanced Examples<a class="headerlink" href="#advanced-examples" title="Permalink to this headline">¶</a></h4>
<p>The examples above are simple examples which only skim the surface of
R’s plotting potential. We include more advanced, model-specific plots
in the Zelig demo scripts, and have created functions that automate some
of these plots, including:</p>
<ol class="arabic">
<li><p class="first"><strong>Ternary Diagrams</strong> describe the predicted probability of a
categorical dependent variable that has three observed outcomes. You
may choose to use this plot with the multinomial logit, the ordinal
logit, or the ordinal probit models (Katz and King, 1999). See for
the sample code, type demo(mlogit) at the R prompt to run the
example, and refer to Section [ternary] to add points to a ternary
diagram.</p>
<p><img alt="image" src="docs/figs/vertci" /></p>
</li>
<li><p class="first"><strong>ROC Plots</strong> summarize how well models for binary dependent
variables (logit, probit, and relogit) fit the data. The ROC plot
evaluates the fraction of 0’s and 1’s correctly predicted for every
possible threshold value at which the continuous
Prob may be realized as a dichotomous prediction.
The closer the ROC curve is to the upper right corner of the plot,
the better the fit of the model specification (King and Zeng,
2002<em>b</em>). See Section [ROC] for the sample code, and type demo(roc)
at the R prompt to run the example.</p>
<p><img alt="image" src="docs/figs/vertci" /></p>
</li>
<li><p class="first"><strong>Vertical Confidence Intervals</strong> may be used for almost any model,
and describe simulated confidence intervals for any quantity of
interest while allowing one of the explanatory variables to vary over
a given range of values (King, Tomz and Wittenberg, 2000). Type
demo(vertci) at the R prompt to run the example, and
help.zelig(plot.ci) for the manual page.</p>
<p><img alt="image" src="docs/figs/vertci" /> [plot.vertci]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="r-objects">
<span id="userguide-r-objects"></span><h2><a class="toc-backref" href="#id42">R Objects</a><a class="headerlink" href="#r-objects" title="Permalink to this headline">¶</a></h2>
<p>In R, objects can have one or more classes, consisting of the class of
the scalar value and the class of the data structure holding the scalar
value. Use the is() command to determine what an object <em>is</em>. If you are
already familiar with R objects, you may skip to for loading data, or
for a description of Zelig commands.</p>
<div class="section" id="scalar-values">
<h3><a class="toc-backref" href="#id43">Scalar Values</a><a class="headerlink" href="#scalar-values" title="Permalink to this headline">¶</a></h3>
<p>R uses several classes of scalar values, from which it constructs larger
data structures. R is highly class-dependent: certain operations will
only work on certain types of values or certain types of data
structures. We list the three basic types of scalar values here for your
reference:</p>
<ol class="arabic">
<li><p class="first"><strong>Numeric</strong> is the default value type for most numbers. An
<tt class="docutils literal"><span class="pre">integer</span></tt> is a subset of the <tt class="docutils literal"><span class="pre">numeric</span></tt> class, and may be used as
a <tt class="docutils literal"><span class="pre">numeric</span></tt> value. You can perform any type of math or logical
operation on numeric values, including:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; log(3 * 4 * (2 + pi))         # Note that pi is a built-in constant,
   [1] 4.122270                 #   and log() the natural log function.
&gt; 2 &gt; 3                         # Basic logical operations, including &gt;,
   [1] FALSE                    #   &lt;, &gt;= (greater than or equals),
                                #   &lt;= (less than or equals), == (exactly
                                #   equals), and != (not equals).
&gt; 3 &gt;= 2 &amp;&amp; 100 == 1000/10      # Advanced logical operations, including
   [1] TRUE                     #   &amp; (and), &amp;&amp; (if and only if), | (or),
                                #   and || (either or).
</pre></div>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">Inf</span></tt> (infinity), <tt class="docutils literal"><span class="pre">-Inf</span></tt> (negative infinity), <tt class="docutils literal"><span class="pre">NA</span></tt>
(missing value), and <tt class="docutils literal"><span class="pre">NaN</span></tt> (not a number) are special numeric
values on which most math operations will fail. (Logical operations
will work, however.)</p>
</li>
<li><p class="first"><strong>Logical</strong> operations create logical values of either <tt class="docutils literal"><span class="pre">TRUE</span></tt> or
<tt class="docutils literal"><span class="pre">FALSE</span></tt>. To convert logical values to numerical values, use the
<tt class="docutils literal"><span class="pre">as.integer()</span></tt> command:</p>
<div class="highlight-python"><div class="highlight"><pre>&gt; as.integer(TRUE)
   [1] 1
&gt; as.integer(FALSE)
   [1] 0
</pre></div>
</div>
</li>
<li><p class="first"><strong>Character</strong> values are text strings. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> text <span class="o">&lt;-</span> <span class="s">&quot;supercalafragilisticxpaladocious&quot;</span>
<span class="o">&gt;</span> text
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;supercalafragilisticxpaladocious&quot;</span>
</pre></div>
</div>
<p>assigns the text string on the right-hand side of the <tt class="docutils literal"><span class="pre">&lt;-</span></tt> to the
named object in your workspace. Text strings are primarily used with
data frames, described in the next section. R always returns
character strings in quotes.</p>
</li>
</ol>
</div>
<div class="section" id="id18">
<h3><a class="toc-backref" href="#id44">Data Structures</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="section" id="arrays">
<h4>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h4>
<p>Arrays are data structures that consist of only one type of scalar value
(e.g., a vector of character strings, or a matrix of numeric values).
The most common versions, one-dimensional and two-dimensional arrays,
are known as <em>vectors</em> and <em>matrices</em>, respectively.</p>
<div class="section" id="ways-to-create-arrays">
<h5>Ways to create arrays<a class="headerlink" href="#ways-to-create-arrays" title="Permalink to this headline">¶</a></h5>
<ol class="arabic">
<li><p class="first">Common ways to create <strong>vectors</strong> (or one-dimensional arrays)
include:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> a <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">11</span><span class="p">)</span>    <span class="c1"># Concatenates numeric values into a vector</span>
<span class="o">&gt;</span> a <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>  <span class="c1"># Concatenates character strings into a vector</span>
<span class="o">&gt;</span> a <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span>               <span class="c1"># Creates a vector of integers from 1 to 5 inclusive</span>
<span class="o">&gt;</span> a <span class="o">&lt;-</span> rep<span class="p">(</span><span class="m">1</span><span class="p">,</span> times <span class="o">=</span> <span class="m">5</span><span class="p">)</span> <span class="c1"># Creates a vector of 5 repeated `1&#39;s</span>
</pre></div>
</div>
<p>To manipulate a vector:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> a<span class="p">[</span><span class="m">10</span><span class="p">]</span>                <span class="c1"># Extracts the 10th value from the vector `a&#39;</span>
<span class="o">&gt;</span> a<span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">3.14</span>         <span class="c1"># Inserts 3.14 as the 5th value in the vector `a&#39;</span>
<span class="o">&gt;</span> a<span class="p">[</span><span class="m">5</span><span class="o">:</span><span class="m">7</span><span class="p">]</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">7</span><span class="p">)</span> <span class="c1"># Replaces the 5th through 7th values with 2, 4, and 7</span>
</pre></div>
</div>
<p><em>Unlike</em> larger arrays, vectors can be extended without first
creating another vector of the correct length. Hence,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> a <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>
<span class="o">&gt;</span> a<span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">9</span>       <span class="c1"># Inserts a 9 in the 5th position of the vector,</span>
                  <span class="c1">#  automatically inserting an `NA&#39; values position 4</span>
</pre></div>
</div>
</li>
<li><p class="first">[factors] A <strong>factor vector</strong> is a special type of vector that allows
users to create  indicator variables in one vector, rather
than using  dummy variables (as in Stata or SPSS). R creates
this special class of vector from a pre-existing vector x using the
factor() command, which separates x into levels based on the discrete
values observed in x. These values may be either integer value or
character strings. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span>
<span class="o">&gt;</span> factor<span class="p">(</span>x<span class="p">)</span>
   <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">2</span> <span class="m">9</span> <span class="m">9</span> <span class="m">9</span> <span class="m">9</span>
   Levels<span class="o">:</span> <span class="m">1</span> <span class="m">2</span> <span class="m">9</span>
</pre></div>
</div>
<p>By default, factor() creates unordered factors, which are treated as
discrete, rather than ordered, levels. Add the optional argument
ordered = TRUE to order the factors in the vector:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;like&quot;</span><span class="p">,</span> <span class="s">&quot;dislike&quot;</span><span class="p">,</span> <span class="s">&quot;hate&quot;</span><span class="p">,</span> <span class="s">&quot;like&quot;</span><span class="p">,</span> <span class="s">&quot;don&#39;t know&quot;</span><span class="p">,</span> <span class="s">&quot;like&quot;</span><span class="p">,</span> <span class="s">&quot;dislike&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> factor<span class="p">(</span>x<span class="p">,</span> levels <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;hate&quot;</span><span class="p">,</span> <span class="s">&quot;dislike&quot;</span><span class="p">,</span> <span class="s">&quot;like&quot;</span><span class="p">,</span> <span class="s">&quot;don&#39;t know&quot;</span><span class="p">),</span>
<span class="o">+</span>        ordered <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  <span class="p">[</span><span class="m">1</span><span class="p">]</span> like    dislike    hate    like   don<span class="s">&#39;t know   like   dislike</span>
<span class="s">Levels: hate &lt; dislike &lt; like &lt; don&#39;</span>t know
</pre></div>
</div>
<p>The factor() command orders the levels according to the order in the
optional argument levels. If you omit the levels command, R will
order the values as they occur in the vector. Thus, omitting the
levels argument sorts the levels as like &lt; dislike &lt; hate &lt; don’t
know in the example above. If you omit one or more of the levels in
the list of levels, R returns levels values of NA for the missing
level(s):</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> factor<span class="p">(</span>x<span class="p">,</span> levels <span class="o">=</span> c<span class="p">(</span><span class="s">&quot;hate&quot;</span><span class="p">,</span> <span class="s">&quot;dislike&quot;</span><span class="p">,</span> <span class="s">&quot;like&quot;</span><span class="p">),</span> ordered <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
  <span class="p">[</span><span class="m">1</span><span class="p">]</span> like    dislike hate    like    <span class="o">&lt;</span><span class="kc">NA</span><span class="o">&gt;</span>    like    dislike
Levels<span class="o">:</span> hate <span class="o">&lt;</span> dislike <span class="o">&lt;</span> like
</pre></div>
</div>
<p>Use factored vectors within data frames for plotting (see ), to set
the values of the explanatory variables using setx (see ) and in the
ordinal logit and multinomial logit models (see ).</p>
</li>
<li><p class="first">Build <strong>matrices</strong> (or two-dimensional arrays) from vectors
(one-dimensional arrays). You can create a matrix in two ways:</p>
<ol class="arabic">
<li><p class="first">From a vector: Use the command <tt class="docutils literal"><span class="pre">matrix(vector,</span> <span class="pre">nrow</span> <span class="pre">=</span></tt>
<tt class="docutils literal"><span class="pre">,</span> <span class="pre">ncol</span> <span class="pre">=</span></tt> <tt class="docutils literal"><span class="pre">)</span></tt> to create a
 matrix from the vector by filling in the
columns from left to right. For example,</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> matrix<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">),</span> nrow <span class="o">=</span> <span class="m">2</span><span class="p">,</span> ncol <span class="o">=</span> <span class="m">3</span><span class="p">)</span>
        <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span>       <span class="c1"># Note that when assigning a vector to a</span>
   <span class="p">[</span><span class="m">1</span><span class="p">,]</span>    <span class="m">1</span>    <span class="m">3</span>    <span class="m">5</span>       <span class="c1">#  matrix, none of the rows or columns</span>
   <span class="p">[</span><span class="m">2</span><span class="p">,]</span>    <span class="m">2</span>    <span class="m">4</span>    <span class="m">6</span>       <span class="c1">#  have names.</span>
</pre></div>
</div>
</li>
<li><p class="first">From two or more vectors of length : Use <tt class="docutils literal"><span class="pre">cbind()</span></tt> to
combine  vectors vertically to form a 
matrix, or <tt class="docutils literal"><span class="pre">rbind()</span></tt> to combine  vectors horizontally
to form a  matrix. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">11</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">13</span><span class="p">)</span>         <span class="c1"># Creates a vector `x&#39; of 3 values.</span>
<span class="o">&gt;</span> y <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">55</span><span class="p">,</span> <span class="m">33</span><span class="p">,</span> <span class="m">12</span><span class="p">)</span>         <span class="c1"># Creates another vector `y&#39; of 3 values.</span>
<span class="o">&gt;</span> rbind<span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span>                <span class="c1"># Creates a 2 x 3 matrix.  Note that row</span>
     <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span>          <span class="c1">#  1 is named x and row 2 is named y,</span>
   x   <span class="m">11</span>   <span class="m">12</span>   <span class="m">13</span>          <span class="c1">#  according to the order in which the</span>
   y   <span class="m">55</span>   <span class="m">33</span>   <span class="m">12</span>          <span class="c1">#  arguments were passed to rbind().</span>
<span class="o">&gt;</span> cbind<span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span>                <span class="c1"># Creates a 3 x 2 matrix.  Note that the</span>
         x  y                <span class="c1">#  columns are named according to the</span>
   <span class="p">[</span><span class="m">1</span><span class="p">,]</span> <span class="m">11</span> <span class="m">55</span>                <span class="c1">#  order in which they were passed to</span>
   <span class="p">[</span><span class="m">2</span><span class="p">,]</span> <span class="m">12</span> <span class="m">33</span>                <span class="c1">#  cbind().</span>
   <span class="p">[</span><span class="m">3</span><span class="p">,]</span> <span class="m">13</span> <span class="m">12</span>
</pre></div>
</div>
</li>
</ol>
<p>R supports a variety of matrix functions, including: <tt class="docutils literal"><span class="pre">det()</span></tt>, which
returns the matrix’s determinant; <tt class="docutils literal"><span class="pre">t()</span></tt>, which transposes the
matrix; <tt class="docutils literal"><span class="pre">solve()</span></tt>, which inverts the the matrix; and <tt class="docutils literal"><span class="pre">%%</span></tt>, which
multiplies two matricies. In addition, the <tt class="docutils literal"><span class="pre">dim()</span></tt> command returns
the dimensions of your matrix. As with vectors, square brackets
extract specific values from a matrix and the assignment mechanism
<tt class="docutils literal"><span class="pre">&lt;-</span></tt> replaces values. For example:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> loo<span class="p">[,</span><span class="m">3</span><span class="p">]</span>             <span class="c1"># Extracts the third column of loo.</span>
<span class="o">&gt;</span> loo<span class="p">[</span><span class="m">1</span><span class="p">,]</span>             <span class="c1"># Extracts the first row of loo.</span>
<span class="o">&gt;</span> loo<span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="m">13</span>          <span class="c1"># Inserts 13 as the value for row 1, column 3.</span>
<span class="o">&gt;</span> loo<span class="p">[</span><span class="m">1</span><span class="p">,]</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">)</span>     <span class="c1"># Replaces the first row of loo.</span>
</pre></div>
</div>
<p>If you encounter problems replacing rows or columns, make sure that
the <tt class="docutils literal"><span class="pre">dims()</span></tt> of the vector matches the <tt class="docutils literal"><span class="pre">dims()</span></tt> of the matrix you
are trying to replace.</p>
</li>
<li><p class="first">An <strong>n-dimensional array</strong> is a set of stacked matrices of identical
dimensions. For example, you may create a three dimensional array
with dimensions  by stacking  matrices each
with  rows and  columns.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> a <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>       <span class="c1"># Creates a 2 x 3 matrix populated with 8&#39;s.</span>
<span class="o">&gt;</span> b <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>       <span class="c1"># Creates a 2 x 3 matrix populated with 9&#39;s.</span>
<span class="o">&gt;</span> array<span class="p">(</span>c<span class="p">(</span>a<span class="p">,</span> b<span class="p">),</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span> <span class="c1"># Creates a 2 x 3 x 2 array with the first</span>
   <span class="p">,</span> <span class="p">,</span> <span class="m">1</span>                     <span class="c1">#  level [,,1] populated with matrix a (8&#39;s),</span>
                             <span class="c1">#  and the second level [,,2] populated</span>
        <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span>       <span class="c1">#  with matrix b (9&#39;s).</span>
   <span class="p">[</span><span class="m">1</span><span class="p">,]</span>    <span class="m">8</span>    <span class="m">8</span>    <span class="m">8</span>
   <span class="p">[</span><span class="m">2</span><span class="p">,]</span>    <span class="m">8</span>    <span class="m">8</span>    <span class="m">8</span>       <span class="c1"># Use square brackets to extract values.  For</span>
                             <span class="c1">#  example, [1, 2, 2] extracts the second</span>
   <span class="p">,</span> <span class="p">,</span> <span class="m">2</span>                     <span class="c1">#  value in the first row of the second level.</span>
                             <span class="c1"># You may also use the &lt;- operator to</span>
        <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span>       <span class="c1">#  replace values.</span>
   <span class="p">[</span><span class="m">1</span><span class="p">,]</span>    <span class="m">9</span>    <span class="m">9</span>    <span class="m">9</span>
   <span class="p">[</span><span class="m">2</span><span class="p">,]</span>    <span class="m">9</span>    <span class="m">9</span>    <span class="m">9</span>
</pre></div>
</div>
<p>If an array is a one-dimensional vector or two-dimensional matrix, R
will treat the array using the more specific method.</p>
</li>
</ol>
<p>Three functions especially helpful for arrays:</p>
<ul>
<li><p class="first">is() returns both the type of scalar value that populates the array,
as well as the specific type of array (vector, matrix, or array more
generally).</p>
</li>
<li><p class="first">dims() returns the size of an array, where</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> dims<span class="p">(</span>b<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">33</span>  <span class="m">5</span>
</pre></div>
</div>
<p>indicates that the array is two-dimensional (a matrix), and has 33
rows and 5 columns.</p>
</li>
<li><p class="first">The single bracket <tt class="docutils literal"><span class="pre">[</span> <span class="pre">]</span></tt> indicates specific values in the array.
Use commas to indicate the index of the specific values you would
like to pull out or replace:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> dims<span class="p">(</span>a<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">14</span>
<span class="o">&gt;</span> a<span class="p">[</span><span class="m">10</span><span class="p">]</span>       <span class="c1"># Pull out the 10th value in the vector `a&#39;</span>
<span class="o">&gt;</span> dims<span class="p">(</span>b<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">33</span>  <span class="m">5</span>
<span class="o">&gt;</span> b<span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">,</span> <span class="p">]</span>   <span class="c1"># Pull out the first 12 rows of `b&#39;</span>
<span class="o">&gt;</span> c<span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">]</span>     <span class="c1"># Pull out the value in the first row, second column of `c&#39;</span>
<span class="o">&gt;</span> dims<span class="p">(</span>d<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">1000</span>  <span class="m">4</span>  <span class="m">5</span>
<span class="o">&gt;</span> d<span class="p">[</span> <span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">1</span><span class="p">]</span>  <span class="c1"># Pulls out a vector of 1,000 values</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="lists">
<h4>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h4>
<p>Unlike arrays, which contain only one type of scalar value, lists are
flexible data structures that can contain heterogeneous value types and
heterogeneous data structures. Lists are so flexible that one list can
contain another list. For example, the list output can contain coef, a
vector of regression coefficients; variance, the variance-covariance
matrix; and another list terms that describes the data using character
strings. Use the names() function to view the named elements in a list,
and to extract a named element, use</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> names<span class="p">(</span>output<span class="p">)</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span> coefficients   variance   terms
<span class="o">&gt;</span> output<span class="o">$</span>coefficients
</pre></div>
</div>
<p>For lists where the elements are not named, use double square brackets
<tt class="docutils literal"><span class="pre">[[</span> <span class="pre">]]</span></tt> to extract elements:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> L<span class="p">[[</span><span class="m">4</span><span class="p">]]</span>      <span class="c1"># Extracts the 4th element from the list `L&#39;</span>
<span class="o">&gt;</span> L<span class="p">[[</span><span class="m">4</span><span class="p">]]</span> <span class="o">&lt;-</span> b <span class="c1"># Replaces the 4th element of the list `L&#39; with a matrix `b&#39;</span>
</pre></div>
</div>
<p>Like vectors, lists are flexible data structures that can be extended
without first creating another list of with the correct number of
elements:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> L <span class="o">&lt;-</span> list<span class="p">()</span>                      <span class="c1"># Creates an empty list</span>
<span class="o">&gt;</span> L<span class="o">$</span>coefficients <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>  <span class="c1"># Inserts a vector into the list, and</span>
                                   <span class="c1">#  names that vector `coefficients&#39;</span>
                   <span class="c1">#  within the list</span>
<span class="o">&gt;</span> L<span class="p">[[</span><span class="m">4</span><span class="p">]]</span> <span class="o">&lt;-</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span>          <span class="c1"># Inserts the vector into the 4th position</span>
                                   <span class="c1">#  in the list.  If this list doesn&#39;t</span>
                                   <span class="c1">#  already have 4 elements, the empty</span>
                                   <span class="c1">#  elements will be `NULL&#39; values</span>
</pre></div>
</div>
<p>Alternatively, you can easily create a list using objects that already
exist in your workspace:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> L <span class="o">&lt;-</span> list<span class="p">(</span>coefficients <span class="o">=</span> k<span class="p">,</span> variance <span class="o">=</span> v<span class="p">)</span> <span class="c1"># Where `k&#39; is a vector and</span>
                                            <span class="c1">#   `v&#39; is a matrix</span>
</pre></div>
</div>
</div>
<div class="section" id="data-frames">
<h4>Data Frames<a class="headerlink" href="#data-frames" title="Permalink to this headline">¶</a></h4>
<p>A data frame (or data set) is a special type of list in which each
variable is constrained to have the same number of observations. A data
frame may contain variables of different types (numeric, integer,
logical, character, and factor), so long as each variable has the same
number of observations.</p>
<p>Thus, a data frame can use both matrix commands and list commands to
manipulate variables and observations.
.
. sourcecode:: r</p>
<blockquote>
<div><p>&gt; dat[1:10,]         # Extracts observations 1-10 and all associated variables
&gt; dat[dat$grp == 1,] # Extracts all observations that belong to group 1
&gt; group &lt;- dat$grp   # Saves the variable <a href="#id19"><span class="problematic" id="id20">`</span></a>grp&#8217; as a vector <a href="#id21"><span class="problematic" id="id22">`</span></a>group&#8217; in</p>
<blockquote>
<div>#   the workspace, not in the data frame</div></blockquote>
<p>&gt; var4 &lt;- dat[[4]]   # Saves the 4th variable as a <a href="#id23"><span class="problematic" id="id24">`</span></a>var4&#8217; in the workspace</p>
</div></blockquote>
<p>For a comprehensive introduction to data frames and recoding data, see .</p>
</div>
<div class="section" id="identifying-objects-and-data-structures">
<h4>Identifying Objects and Data Structures<a class="headerlink" href="#identifying-objects-and-data-structures" title="Permalink to this headline">¶</a></h4>
<p>Each data structure has several <em>attributes</em> which describe it. Although
these attributes are normally invisible to users (e.g., not printed to
the screen when one types the name of the object), there are several
helpful functions that display particular attributes:</p>
<ul class="simple">
<li>For arrays, dims() returns the size of each dimension.</li>
<li>For arrays, is() returns the scalar value type and specific type of
array (vector, matrix, array). For more complex data structures, is()
returns the default methods (classes) for that object.</li>
<li>For lists and data frames, names() returns the variable names, and
str() returns the variable names and a short description of each
element.</li>
</ul>
<p>For almost all data types, you may use summary() to get summary
statistics.</p>
</div>
</div>
</div>
<div class="section" id="programming-statements">
<span id="userguide-programming-statements"></span><h2><a class="toc-backref" href="#id45">Programming Statements</a><a class="headerlink" href="#programming-statements" title="Permalink to this headline">¶</a></h2>
<p>This chapter introduces the main programming commands. These include
functions, if-else statements, for-loops, and special procedures for
managing the inputs to statistical models.</p>
<div class="section" id="functions">
<h3><a class="toc-backref" href="#id46">Functions</a><a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>Functions are either built-in or user-defined sets of encapsulated
commands which may take any number of arguments. Preface a function with
the function statement and use the &lt;- operator to assign functions to
objects in your workspace.</p>
<p>You may use functions to run the same procedure on different objects in
your workspace. For example,</p>
<div class="highlight-r"><div class="highlight"><pre>check <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>p<span class="p">,</span> q<span class="p">)</span> <span class="p">{</span>
 result <span class="o">&lt;-</span> <span class="p">(</span>p <span class="o">-</span> q<span class="p">)</span><span class="o">/</span>q
 result
 <span class="p">}</span>
</pre></div>
</div>
<p>is a simple function with arguments p and q which calculates the
difference between the th elements of the vector p and the
th element of the vector q as a proportion of the
th element of q, and returns the resulting vector. For
example, check(p = 10, q = 2) returns 4. You may omit the descriptors as
long as you keep the arguments in the correct order: check(10, 2) also
returns 4. You may also use other objects as inputs to the function. If
again = 10 and really = 2, then check(p = again, q = really) and
check(again, really) also returns 4.</p>
<p>Because functions run commands as a set, you should make sure that each
command in your function works by testing each line of the function at
the R prompt.</p>
</div>
<div class="section" id="if-statements">
<h3><a class="toc-backref" href="#id47">If-Statements</a><a class="headerlink" href="#if-statements" title="Permalink to this headline">¶</a></h3>
<p>Use if (and optionally, else) to control the flow of R functions. For
example, let x and y be scalar numerical values:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="kr">if</span> <span class="p">(</span>x <span class="o">==</span> y<span class="p">)</span> <span class="p">{</span>                <span class="c1"># If the logical statement in the ()&#39;s is true,</span>
  x <span class="o">&lt;-</span> <span class="kc">NA</span>                    <span class="c1">#  then `x&#39; is changed to `NA&#39; (missing value).</span>
<span class="p">}</span>
<span class="kr">else</span> <span class="p">{</span>                       <span class="c1"># The `else&#39; statement tells R what to do if</span>
  x <span class="o">&lt;-</span> x<span class="o">^</span><span class="m">2</span>                   <span class="c1">#  the if-statement is false.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As with a function, use { and } to define the set of commands associated
with each if and else statement. (If you include if statements inside
functions, you may have multiple sets of nested curly braces.)</p>
</div>
<div class="section" id="for-loops">
<h3><a class="toc-backref" href="#id48">For-Loops</a><a class="headerlink" href="#for-loops" title="Permalink to this headline">¶</a></h3>
<p>Use for to repeat (loop) operations. Avoiding loops by using matrix or
vector commands is usually faster and more elegant, but loops are
sometimes necessary to assign values. If you are using a loop to assign
values to a data structure, you must first initialize an empty data
structure to hold the values you are assigning.</p>
<p>Select a data structure compatible with the type of output your loop
will generate. If your loop generates a scalar, store it in a vector
(with the th value in the vector corresponding to the the
th run of the loop). If your loop generates vector output,
store them as rows (or columns) in a matrix, where the th row
(or column) corresponds to the th iteration of the loop. If
your output consists of matrices, stack them into an array. For list
output (such as regression output) or output that changes dimensions in
each iteration, use a list. To initialize these data structures, use:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> vector<span class="p">()</span>                          <span class="c1"># An empty vector of any length.</span>
<span class="o">&gt;</span> x <span class="o">&lt;-</span> list<span class="p">()</span>                            <span class="c1"># An empty list of any length.</span>
</pre></div>
</div>
<p>The vector() and list() commands create a vector or list of any length,
such that assigning x[5] &lt;- 15 automatically creates a vector with 5
elements, the first four of which are empty values (NA). In contrast,
the matrix() and array() commands create data structures that are
restricted to their original dimensions.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> x <span class="o">&lt;-</span> matrix<span class="p">(</span>nrow <span class="o">=</span> <span class="m">5</span><span class="p">,</span> ncol <span class="o">=</span> <span class="m">2</span><span class="p">)</span>  <span class="c1"># A matrix with 5 rows and 2 columns.</span>
<span class="o">&gt;</span> x <span class="o">&lt;-</span> array<span class="p">(</span>dim <span class="o">=</span> c<span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">))</span>       <span class="c1"># A 3D array of 3 stacked 5 by 2 matrices.</span>
</pre></div>
</div>
<p>If you attempt to assign a value at  to either of
these data structures, R will return an error message (“subscript is out
of bounds”). R does not automatically extend the dimensions of either a
matrix or an array to accommodate additional values.</p>
<div class="highlight-r"><div class="highlight"><pre>x <span class="o">&lt;-</span> array<span class="p">()</span>             <span class="c1"># Initializes an empty data structure.</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span> <span class="p">{</span>        <span class="c1"># Loops through every value from 1 to 10, replacing</span>
  <span class="kr">if</span> <span class="p">(</span>is.integer<span class="p">(</span>i<span class="o">/</span><span class="m">2</span><span class="p">))</span> <span class="p">{</span> <span class="c1">#  the even values in `x&#39; with i+5.</span>
    x<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> i <span class="o">+</span> <span class="m">5</span>
  <span class="p">}</span>
<span class="p">}</span>                        <span class="c1"># Enclose multiple commands in {}.</span>
</pre></div>
</div>
<p>You may use for() inside or outside of functions.</p>
<p>Example 2: Creating dummy variables by hand
!!!</p>
<p>You may also use a loop to create a matrix of dummy variables to append
to a data frame. For example, to generate fixed effects for each state,
let’s say that you have mydata which contains y, x1, x2, x3, and state,
with state a character variable with 50 unique values. There are three
ways to create dummy variables: 1) with a built-in R command; 2) with
one loop; or 3) with 2 for loops.</p>
<ol class="arabic">
<li><p class="first">R will create dummy variables on the fly from a single variable with
distinct values.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>y <span class="o">~</span> x1 <span class="o">+</span> x2 <span class="o">+</span> x3 <span class="o">+</span> as.factor<span class="p">(</span>state<span class="p">),</span>
                 data <span class="o">=</span> mydata<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;ls&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This method returns  indicators for  states.</p>
</li>
<li><p class="first">Alternatively, you can use a loop to create dummy variables by hand.
There are two ways to do this, but both start with the same initial
commands. Using vector commands, first create an index of for the
states, and initialize a matrix to hold the dummy variables:</p>
<div class="highlight-r"><div class="highlight"><pre>idx <span class="o">&lt;-</span> sort<span class="p">(</span>unique<span class="p">(</span>mydata<span class="o">$</span>state<span class="p">))</span>
dummy <span class="o">&lt;-</span> matrix<span class="p">(</span><span class="kc">NA</span><span class="p">,</span> nrow <span class="o">=</span> nrow<span class="p">(</span>mydata<span class="p">),</span> ncol <span class="o">=</span> length<span class="p">(</span>idx<span class="p">))</span>
</pre></div>
</div>
<p>Now choose between the two methods.</p>
<ol class="arabic">
<li><p class="first">The first method is computationally inefficient, but more
intuitive for users not accustomed to vector operations. The first
loop uses i as in index to loop through all the rows, and the
second loop uses j to loop through all 50 values in the vector
idx, which correspond to columns 1 through 50 in the matrix dummy.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>nrow<span class="p">(</span>mydata<span class="p">))</span> <span class="p">{</span>
  <span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>length<span class="p">(</span>idx<span class="p">))</span> <span class="p">{</span>
    <span class="kr">if</span> <span class="p">(</span>mydata<span class="o">$</span>state<span class="p">[</span>i<span class="p">,</span>j<span class="p">]</span> <span class="o">==</span> idx<span class="p">[</span>j<span class="p">])</span> <span class="p">{</span>
      dummy<span class="p">[</span>i<span class="p">,</span>j<span class="p">]</span> <span class="o">&lt;-</span> <span class="m">1</span>
    <span class="p">}</span>
    <span class="kr">else</span> <span class="p">{</span>
      dummy<span class="p">[</span>i<span class="p">,</span>j<span class="p">]</span> <span class="o">&lt;-</span> <span class="m">0</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then add the new matrix of dummy variables to your data frame:</p>
<div class="highlight-r"><div class="highlight"><pre>names<span class="p">(</span>dummy<span class="p">)</span> <span class="o">&lt;-</span> idx
mydata <span class="o">&lt;-</span> cbind<span class="p">(</span>mydata<span class="p">,</span> dummy<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">As you become more comfortable with vector operations, you can
replace the double loop procedure above with one loop:</p>
<div class="highlight-r"><div class="highlight"><pre><span class="kr">for</span> <span class="p">(</span>j <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>length<span class="p">(</span>idx<span class="p">))</span> <span class="p">{</span>
  dummy<span class="p">[,</span>j<span class="p">]</span> <span class="o">&lt;-</span> as.integer<span class="p">(</span>mydata<span class="o">$</span>state <span class="o">==</span> idx<span class="p">[</span>j<span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The single loop procedure evaluates each element in idx against
the vector mydata$state. This creates a vector of 
TRUE/FALSE observations, which you may transform to 1’s and 0’s
using as.integer(). Assign the resulting vector to the appropriate
column in dummy. Combine the dummy matrix with the data frame as
above to complete the procedure.</p>
</li>
</ol>
</li>
</ol>
<p>Selecting the by option in zelig() partitions the data frame and then
automatically loops the specified model through each partition. Suppose
that mydata is a data frame with variables y, x1, x2, x3, and state,
with state a factor variable with 50 unique values. Let’s say that you
would like to run a weighted regression where each observation is
weighted by the inverse of the standard error on x1, estimated for that
observation’s state. In other words, we need to first estimate the model
for each of the 50 states, calculate 1 / se(x1) for each
state , and then assign these weights to each
observation in mydata.</p>
<ul>
<li><p class="first">Estimate the model separate for each state using the by option in
zelig():</p>
<div class="highlight-r"><div class="highlight"><pre>z.out <span class="o">&lt;-</span> zelig<span class="p">(</span>y <span class="o">~</span> x1 <span class="o">+</span> x2 <span class="o">+</span> x3<span class="p">,</span> by <span class="o">=</span> <span class="s">&quot;state&quot;</span><span class="p">,</span> data <span class="o">=</span> mydata<span class="p">,</span> model <span class="o">=</span> <span class="s">&quot;ls&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now z.out is a list of 50 regression outputs.</p>
</li>
<li><p class="first">Extract the standard error on x1 for each of the state level
regressions.</p>
<div class="highlight-r"><div class="highlight"><pre>se <span class="o">&lt;-</span> array<span class="p">()</span>                          <span class="c1"># Initalize the empty data structure.</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">)</span> <span class="p">{</span>                      <span class="c1"># vcov() creates the variance matrix</span>
  se<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> sqrt<span class="p">(</span>vcov<span class="p">(</span>z.out<span class="p">[[</span>i<span class="p">]])[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">])</span> <span class="c1"># Since we have an intercept, the 2nd</span>
<span class="p">}</span>                                      <span class="c1"># diagonal value corresponds to x1.</span>
</pre></div>
</div>
</li>
<li><p class="first">Create the vector of weights.</p>
<div class="highlight-r"><div class="highlight"><pre>wts <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">/</span> se
</pre></div>
</div>
<p>This vector wts has 50 values that correspond to the 50 sets of
state-level regression output in z.out.</p>
</li>
<li><p class="first">To assign the vector of weights to each observation, we need to match
each observation’s state designation to the appropriate state. For
simplicity, assume that the states are numbered 1 through 50.</p>
<div class="highlight-r"><div class="highlight"><pre>mydata<span class="o">$</span>w <span class="o">&lt;-</span> <span class="kc">NA</span>            <span class="c1"># Initalizing the empty variable</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="m">50</span><span class="p">)</span> <span class="p">{</span>
  mydata<span class="o">$</span>w<span class="p">[</span>mydata<span class="o">$</span>state <span class="o">==</span> i<span class="p">]</span> <span class="o">&lt;-</span> wts<span class="p">[</span>i<span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We use mydata$state as the index (inside the square brackets) to
assign values to mydata$w. Thus, whenever state equals 5 for an
observation, the loop assigns the fifth value in the vector wts to
the variable w in mydata. If we had 500 observations in mydata, we
could use this method to match each of the 500 observations to the
appropriate wts.</p>
<p>If the states are character strings instead of integers, we can use a
slightly more complex version</p>
<div class="highlight-r"><div class="highlight"><pre>mydata<span class="o">$</span>w <span class="o">&lt;-</span> <span class="kc">NA</span>
idx <span class="o">&lt;-</span> sort<span class="p">(</span>unique<span class="p">(</span>mydata<span class="o">$</span>state<span class="p">))</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>length<span class="p">(</span>idx<span class="p">)</span> <span class="p">{</span>
  mydata<span class="o">$</span>w<span class="p">[</span>mydata<span class="o">$</span>state <span class="o">==</span> idx<span class="p">[</span>i<span class="p">]]</span> <span class="o">&lt;-</span> wts<span class="p">[</span>i<span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Now we can run our weighted regression:</p>
<div class="highlight-r"><div class="highlight"><pre>z.wtd <span class="o">&lt;-</span> zelig<span class="p">(</span>y <span class="o">~</span> x1 <span class="o">+</span> x2 <span class="o">+</span> x3<span class="p">,</span> weights <span class="o">=</span> w<span class="p">,</span> data <span class="o">=</span> mydata<span class="p">,</span>
               model <span class="o">=</span> <span class="s">&quot;ls&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


    </div>
      
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../sources/docs/user_guide.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2014, The Zelig Team.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-27761864-7', 'pydata.org');
  ga('send', 'pageview');

</script>



  </body>
</html>